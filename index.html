<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø§Ø³Ø¨ Ø§Ù„ØªØ±Ø§ÙƒØªÙˆØ± Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    
    <link rel="manifest" href="manifest.json">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #2e7d32; --accent: #f57c00; --danger: #d93025; }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ù…Ø®ØµØµØ© */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .glow { box-shadow: 0 0 15px rgba(46, 125, 50, 0.3); }
        
        /* ØªØ®ØµÙŠØµØ§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tab-active {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
            position: relative;
        }
        
        .tab-active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 50%;
            transform: translateX(50%);
            width: 20px;
            height: 4px;
            background: white;
            border-radius: 2px;
        }
        
        /* ØªØ®ØµÙŠØµØ§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .table-striped tbody tr:nth-child(odd) {
            background-color: #f9f9f9;
        }
        
        .table-hover tbody tr:hover {
            background-color: #f0f7f0;
        }
    </style>
    <!-- Font Awesome Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen" dir="rtl">
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="bg-gradient-to-r from-green-700 to-green-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3 space-x-reverse">
                <i class="fas fa-tractor text-3xl"></i>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold">ğŸšœ Ù…Ø­Ø§Ø³Ø¨ Ø§Ù„ØªØ±Ø§ÙƒØªÙˆØ± Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ</h1>
                    <p class="text-green-200 text-xs md:text-sm">Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨Ø© Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„ØªØ±Ø§ÙƒØªÙˆØ± </p>
                </div>
            </div>
            <button onclick="switchTab('backup')" class="bg-green-900 hover:bg-green-950 text-white px-4 py-2 rounded-lg text-sm transition-all duration-300 transform hover:scale-105 flex items-center">
                <i class="fas fa-database mr-2"></i>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
            </button>
        </div>
    </header>

    <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div class="container mx-auto p-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ -->
            <div class="bg-white rounded-2xl shadow-lg p-5 text-center border-r-4 border-green-500 transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                <div class="text-gray-500 text-sm mb-2 flex items-center justify-center">
                    <i class="fas fa-money-bill-wave mr-2"></i>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„
                </div>
                <div id="statIncome" class="text-3xl md:text-4xl font-bold text-green-600 animate-pulse">0</div>
                <div class="text-xs text-gray-400 mt-2">Ø¬Ù†ÙŠÙ‡</div>
            </div>
            
            <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ -->
            <div class="bg-white rounded-2xl shadow-lg p-5 text-center border-r-4 border-orange-500 transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                <div class="text-gray-500 text-sm mb-2 flex items-center justify-center">
                    <i class="fas fa-gas-pump mr-2"></i>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
                </div>
                <div id="statExpense" class="text-3xl md:text-4xl font-bold text-orange-600">0</div>
                <div class="text-xs text-gray-400 mt-2">Ø¬Ù†ÙŠÙ‡</div>
            </div>
            
            <!-- ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ -->
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 rounded-2xl shadow-lg p-5 text-center text-white transition-all duration-300 hover:shadow-xl hover:-translate-y-1 glow">
                <div class="text-green-100 text-sm mb-2 flex items-center justify-center">
                    <i class="fas fa-chart-line mr-2"></i>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­
                </div>
                <div id="statNet" class="text-3xl md:text-4xl font-bold">0</div>
                <div class="text-xs text-green-200 mt-2">Ø¬Ù†ÙŠÙ‡</div>
            </div>
        </div>

        <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
        <div class="bg-white rounded-2xl shadow-lg mb-6 overflow-hidden">
            <div class="flex flex-wrap border-b">
                <button onclick="switchTab('work')" class="tab-btn flex-1 py-4 px-2 text-center font-medium transition-all hover:bg-gray-50" id="tabWork">
                    <i class="fas fa-tractor mr-2"></i>Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†
                </button>
                <button onclick="switchTab('expenses')" class="tab-btn flex-1 py-4 px-2 text-center font-medium transition-all hover:bg-gray-50" id="tabExpenses">
                    <i class="fas fa-gas-pump mr-2"></i>Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
                </button>
                <button onclick="switchTab('history')" class="tab-btn flex-1 py-4 px-2 text-center font-medium transition-all hover:bg-gray-50" id="tabHistory">
                    <i class="fas fa-users mr-2"></i>Ø³Ø¬Ù„ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
                </button>
                <button onclick="switchTab('backup')" class="tab-btn flex-1 py-4 px-2 text-center font-medium transition-all hover:bg-gray-50" id="tabBackup">
                    <i class="fas fa-database mr-2"></i>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                </button>
            </div>
        </div>

        <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ÙŠØ¯Ø§Ù† -->
        <div id="workSection" class="tab-content fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-green-600 mr-3"></i>ØªØ³Ø¬ÙŠÙ„ ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-user mr-2"></i>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†
                        </label>
                        <input type="text" id="clientName" placeholder="Ø§Ø¨Ø­Ø« Ø£Ùˆ Ø£Ø¶Ù Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯" list="namesList"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                        <datalist id="namesList"></datalist>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-calendar mr-2"></i>Ø§Ù„ØªØ§Ø±ÙŠØ®
                        </label>
                        <input type="date" id="workDate"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-map-marker-alt mr-2"></i>Ø§Ù„Ù…ÙƒØ§Ù†
                        </label>
                        <input type="text" id="workLoc" placeholder="Ø§Ù„Ù…Ø²Ø±Ø¹Ø© / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-cogs mr-2"></i>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©
                        </label>
                        <select id="serviceType"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                            <option>Ø­Ø±Ø§Ø«Ø©</option>
                            <option>Ù‚ØµØ§Ø¨ÙŠØ©</option>
                            <option>Ù†Ù‚Ù„</option>
                            <option>ØªÙ†Ø¹ÙŠÙ…</option>
                            <option>Ø¯Ù‚Ø§Ù‚Ø©</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-clock mr-2"></i>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª
                        </label>
                        <input type="number" id="workHours" step="0.5" min="0.5" max="24" oninput="calculateTotal()"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tag mr-2"></i>Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø© (Ø¬Ù†ÙŠÙ‡)
                        </label>
                        <input type="number" id="hourPrice" min="0" oninput="calculateTotal()"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-money-check-alt mr-2"></i>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹
                        </label>
                        <select id="payStatus"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                            <option value="Ø£Ø¬Ù„">Ø£Ø¬Ù„ (Ø¯ÙŠÙ†)</option>
                            <option value="Ù…Ù‚Ø¯Ù…">Ø®Ø§Ù„Øµ</option>
                            <option value="Ù†ØµÙ">Ù†ØµÙ Ø§Ù„Ù…Ø¨Ù„Øº</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-money-bill mr-2"></i>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                        </label>
                        <input type="text" id="totalAmount" readonly
                               class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg font-bold text-green-600 text-lg">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-phone mr-2"></i>Ù‡Ø§ØªÙ Ø§Ù„Ø²Ø¨ÙˆÙ† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                    </label>
                    <input type="tel" id="clientPhone" placeholder="0123456789"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-sticky-note mr-2"></i>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                    </label>
                    <textarea id="workNotes" rows="2" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition"></textarea>
                </div>
                
                <button onclick="addWork()" 
                        class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl flex items-center justify-center">
                    <i class="fas fa-save mr-3 text-xl"></i>
                    Ø­ÙØ¸ ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„
                </button>
            </div>
            
            <!-- Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-history text-blue-600 mr-3"></i>Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
                </h3>
                <div id="recentWork" class="overflow-x-auto">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ -->
        <div id="expensesSection" class="tab-content hidden fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-orange-600 mr-3"></i>ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-calendar mr-2"></i>Ø§Ù„ØªØ§Ø±ÙŠØ®
                        </label>
                        <input type="date" id="expDate"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tags mr-2"></i>Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ
                        </label>
                        <select id="expType"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                            <option value="Ø¯ÙŠØ²Ù„">â›½  Ø¬Ø§Ø²</option>
                            <option value="Ø²ÙŠØª">ğŸ›¢ï¸ Ø²ÙŠØª Ù…Ø­Ø±Ùƒ</option>
                            <option value="ØµÙŠØ§Ù†Ø©">ğŸ”§ ØµÙŠØ§Ù†Ø©</option>
                            <option value="Ù‚Ø·Ø¹ ØºÙŠØ§Ø±">âš™ï¸ Ù‚Ø·Ø¹ ØºÙŠØ§Ø±</option>
                            <option value="Ø¹Ù…Ø§Ù„">ğŸ‘· Ø£Ø¬ÙˆØ± Ø¹Ù…Ø§Ù„</option>
                            <option value="Ø£Ø®Ø±Ù‰">ğŸ“ Ù…ØµØ§Ø±ÙŠÙ Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-money-bill mr-2"></i>Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬Ù†ÙŠÙ‡)
                        </label>
                        <input type="number" id="expAmount" min="0" step="0.01"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-sticky-note mr-2"></i>ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="expDetails" placeholder="Ù…Ø«Ø§Ù„: 100 Ù„ØªØ± Ø¬Ø§Ø² Ù…Ù† Ù…Ø­Ø·Ø©..."
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                </div>
                
                <button onclick="addExpense()" 
                        class="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl flex items-center justify-center">
                    <i class="fas fa-plus-circle mr-3 text-xl"></i>
                    Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ
                </button>
            </div>
            
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-list-alt text-red-600 mr-3"></i>Ø³Ø¬Ù„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
                </h3>
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-medium text-gray-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ: <span id="totalExpenses" class="text-red-600 font-bold">0</span> Ø¯ÙŠÙ†Ø§Ø±</h4>
                    <button onclick="clearExpenses()" class="text-sm bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded-lg transition">
                        <i class="fas fa-trash-alt mr-1"></i>Ø­Ø°Ù Ø§Ù„ÙƒÙ„
                    </button>
                </div>
                <div id="expList" class="space-y-3 max-h-96 overflow-y-auto p-2">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø³Ø¬Ù„ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† -->
        <div id="historySection" class="tab-content hidden fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-users text-purple-600 mr-3"></i>Ø³Ø¬Ù„ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
                    </h3>
                    
                    <div class="flex gap-2">
                        <div class="relative flex-1">
                            <input type="text" id="searchClient" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†..." oninput="renderHistory()"
                                   class="w-full px-4 py-3 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition">
                            <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                        </div>
                        <button onclick="exportAllClients()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg transition">
                            <i class="fas fa-file-export"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                        <div class="text-blue-700 text-sm mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</div>
                        <div id="totalClients" class="text-2xl font-bold text-blue-800">0</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                        <div class="text-green-700 text-sm mb-1">Ø²Ø¨Ø§Ø¦Ù† Ø³Ø¯Ø¯ÙˆØ§ ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø¨Ù„Øº</div>
                        <div id="paidClients" class="text-2xl font-bold text-green-800">0</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                        <div class="text-red-700 text-sm mb-1">Ø²Ø¨Ø§Ø¦Ù† Ù…Ø¯ÙŠÙ†ÙŠÙ†</div>
                        <div id="debtClients" class="text-2xl font-bold text-red-800">0</div>
                    </div>
                </div>
                
                <div id="clientHistoryList" class="space-y-4">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
        <div id="backupSection" class="tab-content hidden fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-4">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-database text-green-600 mr-3"></i>Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    <div class="border-2 border-gray-200 rounded-xl p-5 hover:border-blue-300 transition">
                        <h4 class="font-bold text-lg mb-4 text-gray-700">
                            <i class="fas fa-download text-blue-600 mr-2"></i>ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </h4>
                        <p class="text-gray-600 mb-4 text-sm">
                            Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„ØªØ®Ø²ÙŠÙ†Ù‡Ø§ Ø¨Ø£Ù…Ø§Ù† Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.
                        </p>
                        <button onclick="exportData()" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center mb-3">
                            <i class="fas fa-file-export mr-2"></i>ØªØµØ¯ÙŠØ± ÙƒÙ…Ù„Ù JSON
                        </button>
                        <button onclick="exportCSV()" 
                                class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center">
                            <i class="fas fa-file-csv mr-2"></i>ØªØµØ¯ÙŠØ± ÙƒÙ…Ù„Ù Excel
                        </button>
                    </div>
                    
                    <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    <div class="border-2 border-gray-200 rounded-xl p-5 hover:border-purple-300 transition">
                        <h4 class="font-bold text-lg mb-4 text-gray-700">
                            <i class="fas fa-upload text-purple-600 mr-2"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </h4>
                        <p class="text-gray-600 mb-4 text-sm">
                            Ø§Ø³ØªØ±Ø¬Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø³Ø§Ø¨Ù‚Ø© Ø£Ùˆ Ù…Ù† Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±.
                        </p>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-medium mb-2">Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-purple-400 transition cursor-pointer"
                                 onclick="document.getElementById('importFile').click()">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                <p class="text-gray-500 text-sm">Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§</p>
                                <p class="text-gray-400 text-xs mt-1">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ù Ø¨ØµÙŠØºØ© JSON</p>
                                <input type="file" id="importFile" accept=".json,.txt" class="hidden">
                            </div>
                            <div id="selectedFileName" class="text-sm text-gray-600 mt-2 text-center"></div>
                        </div>
                        <button onclick="importData()" 
                                class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center">
                            <i class="fas fa-file-import mr-2"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>
                </div>
                
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
                <div class="mt-8 p-5 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl">
                    <h4 class="font-bold text-lg mb-4 text-gray-700">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h4>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div class="text-center p-4 bg-white rounded-lg shadow">
                            <div class="text-2xl font-bold text-blue-600" id="backupCount">0</div>
                            <div class="text-sm text-gray-500">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg shadow">
                            <div class="text-2xl font-bold text-green-600" id="storageSize">0 KB</div>
                            <div class="text-sm text-gray-500">Ø­Ø¬Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ†</div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg shadow">
                            <div class="text-2xl font-bold text-purple-600" id="lastBackup">---</div>
                            <div class="text-sm text-gray-500">Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg shadow">
                            <div class="text-2xl font-bold text-orange-600" id="autoBackups">0</div>
                            <div class="text-sm text-gray-500">Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 bg-white p-4 rounded-lg">
                        <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                        ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ù…ØªØµÙØ­Ùƒ. Ù‚Ù… Ø¨Ø¹Ù…Ù„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¯ÙˆØ±ÙŠØ§Ù‹ Ù„Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ù† Ø§Ù„ÙÙ‚Ø¯Ø§Ù†.
                        <button onclick="toggleAutoBackup()" id="autoBackupToggle" class="mr-2 text-blue-600 hover:text-blue-800 font-medium">
                            <i class="fas fa-robot mr-1"></i>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                        </button>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© -->
                <div class="mt-6 p-5 bg-white rounded-xl shadow">
                    <h4 class="font-bold text-lg mb-4 text-gray-700">
                        <i class="fas fa-history text-gray-600 mr-2"></i>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                    </h4>
                    <div id="savedBackups" class="space-y-3 max-h-60 overflow-y-auto p-2">
                        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø²Ø¨ÙˆÙ† -->
    <div id="clientDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" id="modalClientName">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø²Ø¨ÙˆÙ†</h3>
                    <button onclick="closeClientModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]" id="modalClientContent">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-6 mt-8">
        <div class="container mx-auto text-center">
            <p class="mb-2">ğŸšœ <span class="font-bold">Ù…Ø­Ø§Ø³Ø¨ Ø§Ù„ØªØ±Ø§ÙƒØªÙˆØ± Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ</span> - Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨Ø© Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„ØªØ±Ø§ÙƒØªÙˆØ± </p>
            <p class="text-gray-400 text-sm">Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© |ØªØµÙ…ÙŠÙ… :Ù…ÙŠØ±ØºÙ†ÙŠ Ø£Ø¨ÙˆØ§Ù„Ù‚Ø§Ø³Ù… | ÙŠØ¹Ù…Ù„ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</p>
            <div class="mt-4 flex justify-center space-x-4 space-x-reverse">
                <a href="#" class="text-gray-300 hover:text-white transition">
                    <i class="fab fa-whatsapp"></i>
                </a>
                <a href="#" class="text-gray-300 hover:text-white transition">
                    <i class="fas fa-phone"></i>
                </a>
                <a href="#" class="text-gray-300 hover:text-white transition">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>
        </div>
    </footer>

    <script>
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        let data = JSON.parse(localStorage.getItem('tractor_final_db')) || { work: [], expenses: [] };
        let autoBackupEnabled = localStorage.getItem('auto_backup_enabled') === 'true';

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('workDate').value = today;
            document.getElementById('expDate').value = today;
            
            updateDashboard();
            updateBackupStats();
            renderRecentWork();
            initTabs();
            setupEventListeners();
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„
            if (autoBackupEnabled) {
                document.getElementById('autoBackupToggle').innerHTML = '<i class="fas fa-robot mr-1"></i>Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
                autoBackup();
            }
        });

        // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function switchTab(tab) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
                content.classList.remove('fade-in');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.remove('bg-green-600', 'text-white');
                btn.classList.add('text-gray-600');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(tab + 'Section').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById(tab + 'Section').classList.add('fade-in');
            }, 10);
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('tab-active');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('bg-green-600', 'text-white');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('text-gray-600');
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙƒÙ„ ØªØ¨ÙˆÙŠØ¨
            if (tab === 'history') {
                renderHistory();
                updateClientStats();
            } else if (tab === 'expenses') {
                renderExpenses();
            } else if (tab === 'backup') {
                updateBackupStats();
                renderSavedBackups();
            }
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯
        function addWork() {
            const entry = {
                id: Date.now(),
                name: document.getElementById('clientName').value.trim(),
                date: document.getElementById('workDate').value,
                location: document.getElementById('workLoc').value,
                service: document.getElementById('serviceType').value,
                hours: parseFloat(document.getElementById('workHours').value) || 0,
                price: parseFloat(document.getElementById('hourPrice').value) || 0,
                payStatus: document.getElementById('payStatus').value,
                phone: document.getElementById('clientPhone').value,
                notes: document.getElementById('workNotes').value,
                timestamp: new Date().toISOString()
            };

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!entry.name || entry.name.length < 2) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†', 'error');
                document.getElementById('clientName').focus();
                return;
            }
            
            if (!entry.hours || entry.hours <= 0) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª ØµØ­ÙŠØ­', 'error');
                document.getElementById('workHours').focus();
                return;
            }
            
            if (!entry.price || entry.price <= 0) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ø³Ø§Ø¹Ø© ØµØ­ÙŠØ­', 'error');
                document.getElementById('hourPrice').focus();
                return;
            }

            data.work.push(entry);
            save();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('clientName').value = '';
            document.getElementById('workHours').value = '';
            document.getElementById('hourPrice').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('workNotes').value = '';
            document.getElementById('totalAmount').value = '0';
            
            showNotification('ØªÙ… Ø­ÙØ¸ ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            updateDashboard();
            renderRecentWork();
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø· Ù‡Ùˆ Ø³Ø¬Ù„ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†ØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ«Ù‡
            if (!document.getElementById('historySection').classList.contains('hidden')) {
                renderHistory();
            }
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ
        function addExpense() {
            const exp = {
                id: Date.now(),
                date: document.getElementById('expDate').value,
                type: document.getElementById('expType').value,
                amount: parseFloat(document.getElementById('expAmount').value) || 0,
                details: document.getElementById('expDetails').value,
                timestamp: new Date().toISOString()
            };
            
            if (!exp.amount || exp.amount <= 0) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØµØ±ÙˆÙ', 'error');
                return;
            }
            
            data.expenses.push(exp);
            save();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('expAmount').value = '';
            document.getElementById('expDetails').value = '';
            
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            updateDashboard();
            renderExpenses();
        }

        // Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function save() {
            localStorage.setItem('tractor_final_db', JSON.stringify(data));
            updateDashboard();
            
            // Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„
            if (autoBackupEnabled) {
                autoBackup();
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateDashboard() {
            const income = data.work.reduce((s, w) => s + (w.hours * w.price), 0);
            const expenses = data.expenses.reduce((s, e) => s + e.amount, 0);
            
            document.getElementById('statIncome').innerText = income.toLocaleString();
            document.getElementById('statExpense').innerText = expenses.toLocaleString();
            document.getElementById('statNet').innerText = (income - expenses).toLocaleString();
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
            const names = [...new Set(data.work.map(w => w.name))];
            document.getElementById('namesList').innerHTML = names.map(n => `<option value="${n}">`).join('');
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
            document.getElementById('totalExpenses').innerText = expenses.toLocaleString();
        }

        // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        function calculateTotal() {
            const hours = parseFloat(document.getElementById('workHours').value) || 0;
            const price = parseFloat(document.getElementById('hourPrice').value) || 0;
            const total = hours * price;
            
            document.getElementById('totalAmount').value = total.toLocaleString();
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
        function renderRecentWork() {
            const container = document.getElementById('recentWork');
            const recentWork = data.work.slice(-5).reverse();
            
            if (recentWork.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="overflow-x-auto">
                    <table class="min-w-full table-auto table-striped table-hover">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-right">Ø§Ù„Ø²Ø¨ÙˆÙ†</th>
                                <th class="px-4 py-3 text-right">Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                                <th class="px-4 py-3 text-right">Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                                <th class="px-4 py-3 text-right">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th class="px-4 py-3 text-right">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            recentWork.forEach(work => {
                const total = work.hours * work.price;
                const statusColor = work.payStatus === 'Ø£Ø¬Ù„' ? 'bg-red-100 text-red-800' : 
                                  work.payStatus === 'Ù†ØµÙ' ? 'bg-yellow-100 text-yellow-800' : 
                                  'bg-green-100 text-green-800';
                
                html += `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-4 py-3 border-b">${work.name}</td>
                        <td class="px-4 py-3 border-b">${work.service}</td>
                        <td class="px-4 py-3 border-b">${work.hours}</td>
                        <td class="px-4 py-3 border-b font-bold">${total.toLocaleString()}</td>
                        <td class="px-4 py-3 border-b">
                            <span class="px-2 py-1 rounded-full text-xs ${statusColor}">
                                ${work.payStatus}
                            </span>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
        function renderExpenses() {
            const container = document.getElementById('expList');
            const recentExpenses = data.expenses.slice().reverse();
            
            if (recentExpenses.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-8 text-gray-500">
                        <i class="fas fa-gas-pump text-4xl mb-4"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø±ÙŠÙ Ù…Ø³Ø¬Ù„Ø©</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            recentExpenses.forEach(exp => {
                const icon = exp.type === 'Ø¬Ø§Ø²' ? 'â›½' :
                           exp.type === 'Ø²ÙŠØª' ? 'ğŸ›¢ï¸' :
                           exp.type === 'ØµÙŠØ§Ù†Ø©' ? 'ğŸ”§' :
                           exp.type === 'Ù‚Ø·Ø¹ ØºÙŠØ§Ø±' ? 'âš™ï¸' :
                           exp.type === 'Ø¹Ù…Ø§Ù„' ? 'ğŸ‘·' : 'ğŸ“';
                
                html += `
                    <div class="flex items-center justify-between p-4 bg-white border border-gray-200 rounded-xl hover:shadow-md transition">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <div class="text-2xl">${icon}</div>
                            <div>
                                <div class="font-medium">${exp.type}</div>
                                <div class="text-sm text-gray-500">${exp.date} ${exp.details ? 'â€¢ ' + exp.details : ''}</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4 space-x-reverse">
                            <span class="text-lg font-bold text-red-600">${exp.amount.toLocaleString()}</span>
                            <button onclick="deleteExpense(${exp.id})" class="text-gray-400 hover:text-red-500 transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ù…ØµØ±ÙˆÙ
        function deleteExpense(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ±ÙˆÙØŸ')) {
                data.expenses = data.expenses.filter(exp => exp.id !== id);
                save();
                renderExpenses();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ', 'success');
            }
        }

        // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
        function clearExpenses() {
            if (data.expenses.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø±ÙŠÙ Ù„Ø­Ø°ÙÙ‡Ø§', 'info');
                return;
            }
            
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ (${data.expenses.length} Ù…ØµØ±ÙˆÙ)?`)) {
                data.expenses = [];
                save();
                renderExpenses();
                showNotification('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ', 'success');
            }
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
        function renderHistory() {
            const query = document.getElementById('searchClient').value.toLowerCase();
            const container = document.getElementById('clientHistoryList');
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ Ø­Ø³Ø¨ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†
            const grouped = data.work.reduce((acc, curr) => {
                if (!acc[curr.name]) {
                    acc[curr.name] = {
                        items: [],
                        phone: curr.phone,
                        total: 0,
                        debt: 0,
                        lastDate: curr.date
                    };
                }
                acc[curr.name].items.push(curr);
                
                const itemTotal = curr.hours * curr.price;
                acc[curr.name].total += itemTotal;
                
                if (curr.payStatus === 'Ø£Ø¬Ù„') {
                    acc[curr.name].debt += itemTotal;
                } else if (curr.payStatus === 'Ù†ØµÙ') {
                    acc[curr.name].debt += itemTotal / 2;
                }
                
                if (curr.date > acc[curr.name].lastDate) {
                    acc[curr.name].lastDate = curr.date;
                }
                
                return acc;
            }, {});
            
            // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© ÙˆØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ù…Ø¹Ø§Ù…Ù„Ø©
            const clientsArray = Object.keys(grouped)
                .filter(name => name.toLowerCase().includes(query))
                .map(name => ({
                    name,
                    ...grouped[name]
                }))
                .sort((a, b) => new Date(b.lastDate) - new Date(a.lastDate));
            
            if (clientsArray.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-12 text-gray-500">
                        <i class="fas fa-users text-4xl mb-4"></i>
                        <p>${query ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯'}</p>
                        ${query ? '<p class="text-sm mt-2">Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø¢Ø®Ø±</p>' : ''}
                    </div>
                `;
                return;
            }
            
            let html = '';
            clientsArray.forEach(client => {
                const debtPercentage = client.total > 0 ? Math.round((client.debt / client.total) * 100) : 0;
                const lastTransaction = client.items[client.items.length - 1];
                
                html += `
                    <div class="bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition">
                        <div class="p-5 border-b border-gray-100">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold text-lg text-gray-800">${client.name}</h4>
                                    <div class="flex items-center mt-2 space-x-4 space-x-reverse">
                                        ${client.phone ? `
                                            <div class="flex items-center text-sm text-gray-600">
                                                <i class="fas fa-phone mr-2"></i>
                                                ${client.phone}
                                            </div>
                                        ` : ''}
                                        <div class="flex items-center text-sm text-gray-600">
                                            <i class="fas fa-calendar mr-2"></i>
                                            Ø¢Ø®Ø± Ù…Ø¹Ø§Ù…Ù„Ø©: ${client.lastDate}
                                        </div>
                                        <div class="flex items-center text-sm text-gray-600">
                                            <i class="fas fa-list mr-2"></i>
                                            Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: ${client.items.length}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex space-x-2 space-x-reverse">
                                    ${client.phone ? `
                                        <button onclick="window.open('tel:${client.phone}')" 
                                                class="bg-blue-100 hover:bg-blue-200 text-blue-700 p-2 rounded-lg transition">
                                            <i class="fas fa-phone"></i>
                                        </button>
                                    ` : ''}
                                    ${client.phone ? `
                                        <button onclick="shareClientWA('${client.name}')" 
                                                class="bg-green-100 hover:bg-green-200 text-green-700 p-2 rounded-lg transition">
                                            <i class="fab fa-whatsapp"></i>
                                        </button>
                                    ` : ''}
                                    <button onclick="viewClientDetails('${client.name}')" 
                                            class="bg-purple-100 hover:bg-purple-200 text-purple-700 p-2 rounded-lg transition">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-5">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="text-center p-4 bg-gray-50 rounded-lg">
                                    <div class="text-sm text-gray-500 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</div>
                                    <div class="text-2xl font-bold text-gray-800">${client.total.toLocaleString()}</div>
                                    <div class="text-xs text-gray-400">Ø¬Ù†ÙŠÙ‡</div>
                                </div>
                                <div class="text-center p-4 ${client.debt > 0 ? 'bg-red-50' : 'bg-green-50'} rounded-lg">
                                    <div class="text-sm ${client.debt > 0 ? 'text-red-500' : 'text-green-500'} mb-1">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                                    <div class="text-2xl font-bold ${client.debt > 0 ? 'text-red-600' : 'text-green-600'}">
                                        ${client.debt.toLocaleString()}
                                    </div>
                                    <div class="text-xs ${client.debt > 0 ? 'text-red-400' : 'text-green-400'}">
                                        ${client.debt > 0 ? debtPercentage + '% Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ' : 'Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„'}
                                    </div>
                                </div>
                                <div class="text-center p-4 bg-blue-50 rounded-lg">
                                    <div class="text-sm text-blue-500 mb-1">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</div>
                                    <div class="text-2xl font-bold text-blue-600">
                                        ${Math.round(client.total / client.items.length).toLocaleString()}
                                    </div>
                                    <div class="text-xs text-blue-400">Ø¬Ù†ÙŠÙ‡</div>
                                </div>
                            </div>
                            
                            <div class="text-sm text-gray-600">
                                <div class="font-medium mb-2">Ø¢Ø®Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª:</div>
                                <div class="flex flex-wrap gap-2">
                                    ${client.items.slice(-3).reverse().map(item => `
                                        <span class="px-3 py-1 bg-gray-100 rounded-full text-xs">
                                            ${item.date} - ${item.service} (${item.hours} Ø³Ø§Ø¹Ø©)
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateClientStats();
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
        function updateClientStats() {
            const grouped = data.work.reduce((acc, curr) => {
                if (!acc[curr.name]) {
                    acc[curr.name] = {
                        total: 0,
                        debt: 0
                    };
                }
                
                const itemTotal = curr.hours * curr.price;
                acc[curr.name].total += itemTotal;
                
                if (curr.payStatus === 'Ø£Ø¬Ù„') {
                    acc[curr.name].debt += itemTotal;
                } else if (curr.payStatus === 'Ù†ØµÙ') {
                    acc[curr.name].debt += itemTotal / 2;
                }
                
                return acc;
            }, {});
            
            const clientNames = Object.keys(grouped);
            const paidClients = clientNames.filter(name => grouped[name].debt === 0).length;
            const debtClients = clientNames.filter(name => grouped[name].debt > 0).length;
            
            document.getElementById('totalClients').innerText = clientNames.length;
            document.getElementById('paidClients').innerText = paidClients;
            document.getElementById('debtClients').innerText = debtClients;
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø²Ø¨ÙˆÙ†
        function viewClientDetails(clientName) {
            const clientWork = data.work.filter(w => w.name === clientName);
            const clientPhone = clientWork[0]?.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            
            let totalAmount = 0;
            let paidAmount = 0;
            let debtAmount = 0;
            
            let workRows = '';
            clientWork.forEach(work => {
                const workAmount = work.hours * work.price;
                totalAmount += workAmount;
                
                if (work.payStatus === 'Ù…Ù‚Ø¯Ù…') {
                    paidAmount += workAmount;
                } else if (work.payStatus === 'Ù†ØµÙ') {
                    paidAmount += workAmount / 2;
                    debtAmount += workAmount / 2;
                } else {
                    debtAmount += workAmount;
                }
                
                const statusColor = work.payStatus === 'Ø£Ø¬Ù„' ? 'red' : 
                                  work.payStatus === 'Ù†ØµÙ' ? 'yellow' : 'green';
                
                workRows += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 border-b">${work.date}</td>
                        <td class="px-4 py-3 border-b">${work.service}</td>
                        <td class="px-4 py-3 border-b">${work.location}</td>
                        <td class="px-4 py-3 border-b">${work.hours} Ø³Ø§Ø¹Ø©</td>
                        <td class="px-4 py-3 border-b">${work.price}</td>
                        <td class="px-4 py-3 border-b font-bold">${workAmount.toLocaleString()}</td>
                        <td class="px-4 py-3 border-b">
                            <span class="px-2 py-1 rounded-full text-xs bg-${statusColor}-100 text-${statusColor}-800">
                                ${work.payStatus}
                            </span>
                        </td>
                    </tr>
                `;
            });
            
            document.getElementById('modalClientName').innerText = `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø²Ø¨ÙˆÙ†: ${clientName}`;
            document.getElementById('modalClientContent').innerHTML = `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-xl">
                            <div class="text-blue-700 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</div>
                            <div class="text-2xl font-bold text-blue-800">${totalAmount.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-xl">
                            <div class="text-green-700 text-sm">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</div>
                            <div class="text-2xl font-bold text-green-800">${paidAmount.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</div>
                        </div>
                        <div class="bg-red-50 p-4 rounded-xl">
                            <div class="text-red-700 text-sm">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                            <div class="text-2xl font-bold text-red-800">${debtAmount.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="font-bold text-gray-700">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</h5>
                            ${clientPhone !== 'ØºÙŠØ± Ù…ØªÙˆÙØ±' ? `
                                <div class="flex space-x-2 space-x-reverse">
                                    <button onclick="window.open('tel:${clientPhone}')" 
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                                        <i class="fas fa-phone mr-2"></i>Ø§ØªØµØ§Ù„
                                    </button>
                                    <button onclick="shareClientWA('${clientName}')" 
                                            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                                        <i class="fab fa-whatsapp mr-2"></i>ÙˆØ§ØªØ³Ø§Ø¨
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                        <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${clientPhone}</p>
                        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:</strong> ${clientWork.length}</p>
                        <p><strong>Ø£ÙˆÙ„ Ù…Ø¹Ø§Ù…Ù„Ø©:</strong> ${clientWork[clientWork.length - 1]?.date}</p>
                        <p><strong>Ø¢Ø®Ø± Ù…Ø¹Ø§Ù…Ù„Ø©:</strong> ${clientWork[0]?.date}</p>
                    </div>
                    
                    <div>
                        <h5 class="font-bold text-gray-700 mb-4">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h5>
                        <div class="overflow-x-auto">
                            <table class="min-w-full table-auto">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-4 py-3 text-right">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                        <th class="px-4 py-3 text-right">Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                                        <th class="px-4 py-3 text-right">Ø§Ù„Ù…ÙƒØ§Ù†</th>
                                        <th class="px-4 py-3 text-right">Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                                        <th class="px-4 py-3 text-right">Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø©</th>
                                        <th class="px-4 py-3 text-right">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                        <th class="px-4 py-3 text-right">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${workRows}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('clientDetailModal').classList.remove('hidden');
        }

        // Ø¯Ø§Ù„Ø© Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø²Ø¨ÙˆÙ†
        function closeClientModal() {
            document.getElementById('clientDetailModal').classList.add('hidden');
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
        function shareClientWA(clientName) {
            const clientWork = data.work.filter(w => w.name === clientName);
            const clientPhone = clientWork[0]?.phone;
            
            if (!clientPhone) {
                showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø²Ø¨ÙˆÙ†', 'error');
                return;
            }
            
            let totalAmount = 0;
            let debtAmount = 0;
            
            let msg = `*ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ø§ÙƒØªÙˆØ±*%0A%0A`;
            msg += `*Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†:* ${clientName}%0A`;
            msg += `*Ø§Ù„ØªØ§Ø±ÙŠØ®:* ${new Date().toLocaleDateString('ar-SA')}%0A`;
            msg += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€%0A%0A`;
            msg += `*Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„:*%0A`;
            
            clientWork.forEach((work, index) => {
                const workAmount = work.hours * work.price;
                totalAmount += workAmount;
                
                if (work.payStatus !== 'Ù…Ù‚Ø¯Ù…') {
                    debtAmount += work.payStatus === 'Ù†ØµÙ' ? workAmount / 2 : workAmount;
                }
                
                msg += `${index + 1}. ${work.date} - ${work.service} (${work.hours} Ø³Ø§Ø¹Ø©) = ${workAmount} Ø¯ÙŠÙ†Ø§Ø±`;
                msg += work.payStatus !== 'Ù…Ù‚Ø¯Ù…' ? ` (${work.payStatus})` : '';
                msg += `%0A`;
            });
            
            msg += `%0Aâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€%0A`;
            msg += `*Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:* ${totalAmount.toLocaleString()} Ø¬Ù†ÙŠÙ‡%0A`;
            
            if (debtAmount > 0) {
                msg += `*Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:* ${debtAmount.toLocaleString()} Ø¬Ù†ÙŠÙ‡%0A`;
                msg += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€%0A`;
                msg += `*ÙŠØ±Ø¬Ù‰ ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ*%0A`;
            } else {
                msg += `*ØªÙ… ØªØ³Ø¯ÙŠØ¯ ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø¨Ù„Øº* âœ…%0A`;
            }
            
            msg += `%0AØ´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§ ğŸŒ¾`;
            
            window.open(`https://wa.me/${clientPhone}?text=${msg}`);
        }

        // Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
        function exportAllClients() {
            if (data.work.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
                return;
            }
            
            exportCSV();
        }

        // Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ - Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ§Ù„ÙŠØ©:
        // exportData, exportCSV, importData, showNotification, 
        // updateBackupStats, autoBackup, cleanupOldBackups
        
        // Ø¥Ø¶Ø§ÙØ© event listeners
        function setupEventListeners() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø±
            document.getElementById('importFile').addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name || 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù';
                document.getElementById('selectedFileName').innerText = `Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø±: ${fileName}`;
            });
            
            // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            document.getElementById('autoBackupToggle').addEventListener('click', toggleAutoBackup);
        }

        // Ø¯Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function toggleAutoBackup() {
            autoBackupEnabled = !autoBackupEnabled;
            localStorage.setItem('auto_backup_enabled', autoBackupEnabled);
            
            if (autoBackupEnabled) {
                document.getElementById('autoBackupToggle').innerHTML = '<i class="fas fa-robot mr-1"></i>Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
                showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'success');
                autoBackup();
            } else {
                document.getElementById('autoBackupToggle').innerHTML = '<i class="fas fa-robot mr-1"></i>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
                showNotification('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'info');
            }
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function renderSavedBackups() {
            const container = document.getElementById('savedBackups');
            const backups = Object.keys(localStorage)
                .filter(key => key.startsWith('backup_'))
                .map(key => {
                    const timestamp = parseInt(key.split('_')[1]);
                    return {
                        key,
                        date: new Date(timestamp).toLocaleString('ar-SA'),
                        size: localStorage.getItem(key).length
                    };
                })
                .sort((a, b) => parseInt(b.key.split('_')[1]) - parseInt(a.key.split('_')[1]));
            
            if (backups.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-4 text-gray-500">
                        <i class="fas fa-database text-2xl mb-2"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø©</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            backups.forEach(backup => {
                html += `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <i class="fas fa-database text-blue-500"></i>
                            <div>
                                <div class="font-medium">${backup.date}</div>
                                <div class="text-xs text-gray-500">${(backup.size / 1024).toFixed(2)} KB</div>
                            </div>
                        </div>
                        <div class="flex space-x-2 space-x-reverse">
                            <button onclick="restoreBackup('${backup.key}')" 
                                    class="text-green-600 hover:text-green-800 transition">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button onclick="deleteBackup('${backup.key}')" 
                                    class="text-red-600 hover:text-red-800 transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Ø¯Ø§Ù„Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        function restoreBackup(key) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©ØŸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.')) {
                try {
                    const backupData = JSON.parse(localStorage.getItem(key));
                    localStorage.setItem('tractor_final_db', JSON.stringify(backupData));
                    location.reload();
                } catch (error) {
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'error');
                }
            }
        }

        // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        function deleteBackup(key) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©ØŸ')) {
                localStorage.removeItem(key);
                renderSavedBackups();
                updateBackupStats();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'success');
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function initTabs() {
            switchTab('work');
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const icon = type === 'success' ? 'check-circle' :
                        type === 'error' ? 'exclamation-circle' :
                        type === 'warning' ? 'exclamation-triangle' : 'info-circle';
            
            const color = type === 'success' ? 'bg-green-600' :
                         type === 'error' ? 'bg-red-600' :
                         type === 'warning' ? 'bg-yellow-600' : 'bg-blue-600';
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-xl text-white z-50 transform transition-all duration-300 slide-up ${color}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${icon} mr-3 text-xl"></i>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
            </html>
