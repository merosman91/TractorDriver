<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÙÙŠÙ‚ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ - Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¬Ø±Ø§Ø±Ø§Øª</title>
    <meta name="theme-color" content="#4CAF50">
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --primary: #2E7D32; --bg: #f3f4f6; --text: #1f2937; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 80px; }
        
        /* Header */
        header { background-color: var(--primary); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        header h1 { margin: 0; font-size: 1.2rem; }

        /* Container */
        .container { max-width: 600px; margin: 0 auto; padding: 15px; }

        /* Form Card */
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        input:focus { border-color: var(--primary); outline: none; }

        /* Buttons */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:active { transform: scale(0.98); }
        .btn-whatsapp { background-color: #25D366; color: white; margin-top: 5px; width: auto; padding: 8px 15px; font-size: 0.9rem; }
        .btn-delete { background-color: #ef4444; color: white; width: auto; padding: 8px 15px; font-size: 0.9rem; }
        
        /* Task List */
        .task-item { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-right: 5px solid var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; }
        .task-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .task-date { font-size: 0.85rem; color: #666; background: #eee; padding: 3px 8px; border-radius: 4px; }
        .task-hours { font-weight: bold; color: var(--primary); font-size: 1.1rem; }
        .actions { display: flex; gap: 10px; margin-top: 10px; justify-content: flex-end; }
        
        /* Stats */
        .stats { display: flex; justify-content: space-between; background: #e8f5e9; padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #c8e6c9; }
        
        /* Install Prompt */
        #installBtn { display: none; background: #333; color: white; padding: 10px; text-align: center; font-size: 0.9rem; }
    </style>
</head>
<body>

<header>
    <h1>ğŸšœ Ø±ÙÙŠÙ‚ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</h1>
</header>
<div id="installBtn">ğŸ“² Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ</div>

<div class="container">
    <div class="card">
        <h3 style="margin-top:0">ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯</h3>
        <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
            <input type="text" id="customerName" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¨Ùˆ Ù…Ø­Ù…Ø¯">
        </div>
        <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ø¹ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¯ÙˆÙ„Ø©)</label>
            <input type="tel" id="customerPhone" placeholder="Ù…Ø«Ø§Ù„: 966500000000">
        </div>
        <div class="form-group">
            <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
            <input type="date" id="workDate">
        </div>
        <div class="form-group">
            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</label>
            <input type="number" id="workHours" placeholder="0" step="0.5">
        </div>
        <button class="btn btn-primary" onclick="addTask()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„</button>
    </div>

    <div class="stats">
        <span>Ù…Ø¬Ù…ÙˆØ¹ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…:</span>
        <span id="totalHoursToday" style="font-weight:bold">0</span>
    </div>

    <div id="taskList">
        </div>
</div>

<script>
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø©
    let tasks = JSON.parse(localStorage.getItem('tractorTasks')) || [];
    document.getElementById('workDate').valueAsDate = new Date(); // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹

    // 2. Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ù…Ù‡Ù…Ø©
    function addTask() {
        const name = document.getElementById('customerName').value;
        const phone = document.getElementById('customerPhone').value;
        const date = document.getElementById('workDate').value;
        const hours = parseFloat(document.getElementById('workHours').value);

        if (!name || !hours || !date) {
            alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª');
            return;
        }

        const task = {
            id: Date.now(),
            name,
            phone,
            date,
            hours
        };

        tasks.unshift(task); // Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        saveAndRender();
        resetForm();
    }

    // 3. Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©
    function deleteTask(id) {
        if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
            tasks = tasks.filter(t => t.id !== id);
            saveAndRender();
        }
    }

    // 4. Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
    function saveAndRender() {
        localStorage.setItem('tractorTasks', JSON.stringify(tasks));
        renderTasks();
    }

    // 5. Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
    function shareWhatsApp(id) {
        const task = tasks.find(t => t.id === id);
        if (!task) return;

        const text = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${task.name}ØŒ\nØªÙ… Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø§Ù„Ø¬Ø±Ø§Ø± Ø¨ØªØ§Ø±ÙŠØ®: ${task.date}\nØ¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø©: ${task.hours} Ø³Ø§Ø¹Ø§Øª.\nØ´ÙƒØ±Ø§Ù‹ Ù„Ùƒ.`;
        const url = `https://wa.me/${task.phone}?text=${encodeURIComponent(text)}`;
        window.open(url, '_blank');
    }

    // 6. Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø©
    function renderTasks() {
        const list = document.getElementById('taskList');
        list.innerHTML = '';
        
        let todayHours = 0;
        const todayStr = new Date().toISOString().split('T')[0];

        tasks.forEach(task => {
            // Ø­Ø³Ø§Ø¨ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…
            if(task.date === todayStr) {
                todayHours += task.hours;
            }

            const div = document.createElement('div');
            div.className = 'task-item';
            div.innerHTML = `
                <div class="task-header">
                    <strong>ğŸ‘¤ ${task.name}</strong>
                    <span class="task-date">${task.date}</span>
                </div>
                <div>â±ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª: <span class="task-hours">${task.hours}</span></div>
                ${task.phone ? `<div style="font-size:0.9rem; color:#666; margin-top:5px">ğŸ“ ${task.phone}</div>` : ''}
                <div class="actions">
                    <button class="btn btn-delete" onclick="deleteTask(${task.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    <button class="btn btn-whatsapp" onclick="shareWhatsApp(${task.id})">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
                </div>
            `;
            list.appendChild(div);
        });

        document.getElementById('totalHoursToday').innerText = todayHours;
    }

    function resetForm() {
        document.getElementById('customerName').value = '';
        document.getElementById('customerPhone').value = '';
        document.getElementById('workHours').value = '';
    }

    // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
    renderTasks();

    // ØªØ³Ø¬ÙŠÙ„ Service Worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
        .then(() => console.log('Service Worker Registered'));
    }

    // Ù…Ù†Ø·Ù‚ Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª (PWA Install)
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        const installBtn = document.getElementById('installBtn');
        installBtn.style.display = 'block';

        installBtn.addEventListener('click', () => {
            installBtn.style.display = 'none';
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                deferredPrompt = null;
            });
        });
    });
</script>

</body>
</html>
