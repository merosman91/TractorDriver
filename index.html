<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฑููู ุงููุฒุงุฑุน</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2E7D32">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ุฑููู ุงููุฒุงุฑุน">
    
    <!-- Icons for all platforms -->
    <link rel="icon" href="/icon512.png" type="image/png">
    <link rel="shortcut icon" href="/icon512.png" type="image/png">
    <link rel="apple-touch-icon" href="/icon512.png">
    
    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #2e7d32; --accent: #f57c00; --danger: #d93025; }
        
        /* ุชุฃุซูุฑุงุช ูุฎุตุตุฉ */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .glow { box-shadow: 0 0 15px rgba(46, 125, 50, 0.3); }
        
        /* ุชุฎุตูุตุงุช ุงูุชุจููุจุงุช */
        .tab-active {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
            position: relative;
        }
        
        .tab-active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 50%;
            transform: translateX(50%);
            width: 20px;
            height: 4px;
            background: white;
            border-radius: 2px;
        }
        
        /* ุชุฎุตูุตุงุช ุงูุฌุฏูู */
        .table-striped tbody tr:nth-child(odd) {
            background-color: #f9f9f9;
        }
        
        .table-hover tbody tr:hover {
            background-color: #f0f7f0;
        }
        
        /* ุชุฎุตูุต ุงููุฑูุช */
        .client-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .client-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }
        
        /* ุดุฑูุท ุงูุชูุฏู */
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            background-color: #e5e7eb;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
    </style>
    <!-- Font Awesome ููุฃููููุงุช -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen" dir="rtl">
    <!-- ุงูููุฏุฑ -->
    <header class="bg-gradient-to-r from-green-700 to-green-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3 space-x-reverse">
                <i class="fas fa-tractor text-3xl"></i>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold">๐ ูุญุงุณุจ ุงูุชุฑุงูุชูุฑ ุงูุฒุฑุงุนู</h1>
                    <p class="text-green-200 text-xs md:text-sm">ูุธุงู ูุญุงุณุจุฉ ูุชูุงูู ูุณุงุฆู ุงูุชุฑุงูุชูุฑ</p>
                </div>
            </div>
            <div class="flex items-center space-x-2 space-x-reverse">
                <button onclick="switchTab('reports')" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-sm transition-all duration-300 transform hover:scale-105 flex items-center">
                    <i class="fas fa-chart-bar mr-2"></i>ุงูุชูุงุฑูุฑ
                </button>
                <button onclick="switchTab('backup')" class="bg-green-900 hover:bg-green-950 text-white px-4 py-2 rounded-lg text-sm transition-all duration-300 transform hover:scale-105 flex items-center">
                    <i class="fas fa-database mr-2"></i>ุงููุณุฎ ุงูุงุญุชูุงุทู
                </button>
            </div>
        </div>
    </header>

    <!-- ุงูุฅุญุตุงุฆูุงุช -->
    <div class="container mx-auto p-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- ุฅุฌูุงูู ุงูุนูู -->
            <div class="bg-white rounded-2xl shadow-lg p-5 text-center border-r-4 border-green-500 transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                <div class="text-gray-500 text-sm mb-2 flex items-center justify-center">
                    <i class="fas fa-money-bill-wave mr-2"></i>ุฅุฌูุงูู ุงูุนูู
                </div>
                <div id="statIncome" class="text-3xl md:text-4xl font-bold text-green-600 animate-pulse">0</div>
                <div class="text-xs text-gray-400 mt-2">ุฌููู</div>
            </div>
            
            <!-- ุฅุฌูุงูู ุงููุตุงุฑูู -->
            <div class="bg-white rounded-2xl shadow-lg p-5 text-center border-r-4 border-orange-500 transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                <div class="text-gray-500 text-sm mb-2 flex items-center justify-center">
                    <i class="fas fa-gas-pump mr-2"></i>ุฅุฌูุงูู ุงููุตุงุฑูู
                </div>
                <div id="statExpense" class="text-3xl md:text-4xl font-bold text-orange-600">0</div>
                <div class="text-xs text-gray-400 mt-2">ุฌููู</div>
            </div>
            
            <!-- ุตุงูู ุงูุฑุจุญ -->
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 rounded-2xl shadow-lg p-5 text-center text-white transition-all duration-300 hover:shadow-xl hover:-translate-y-1 glow">
                <div class="text-green-100 text-sm mb-2 flex items-center justify-center">
                    <i class="fas fa-chart-line mr-2"></i>ุตุงูู ุงูุฑุจุญ
                </div>
                <div id="statNet" class="text-3xl md:text-4xl font-bold">0</div>
                <div class="text-xs text-green-200 mt-2">ุฌููู</div>
            </div>
        </div>

        <!-- ุงูุชุจููุจุงุช -->
        <div class="bg-white rounded-2xl shadow-lg mb-6 overflow-hidden">
            <div class="flex flex-wrap border-b">
                <button onclick="switchTab('work')" class="tab-btn flex-1 py-4 px-2 text-center font-medium transition-all hover:bg-gray-50" id="tabWork">
                    <i class="fas fa-tractor mr-2"></i>ุฃุนูุงู ุงูููุฏุงู
                </button>
                <button onclick="switchTab('expenses')" class="tab-btn flex-1 py-4 px-2 text-center font-medium transition-all hover:bg-gray-50" id="tabExpenses">
                    <i class="fas fa-gas-pump mr-2"></i>ุงููุตุงุฑูู
                </button>
                <button onclick="switchTab('history')" class="tab-btn flex-1 py-4 px-2 text-center font-medium transition-all hover:bg-gray-50" id="tabHistory">
                    <i class="fas fa-users mr-2"></i>ุณุฌู ุงูุฒุจุงุฆู
                </button>
                <button onclick="switchTab('reports')" class="tab-btn flex-1 py-4 px-2 text-center font-medium transition-all hover:bg-gray-50" id="tabReports">
                    <i class="fas fa-chart-bar mr-2"></i>ุงูุชูุงุฑูุฑ
                </button>
                <button onclick="switchTab('backup')" class="tab-btn flex-1 py-4 px-2 text-center font-medium transition-all hover:bg-gray-50" id="tabBackup">
                    <i class="fas fa-database mr-2"></i>ุงููุณุฎ ุงูุงุญุชูุงุทู
                </button>
            </div>
        </div>

        <!-- ูุญุชูู ุงูุชุจููุจุงุช -->
        
        <!-- ุชุจููุจ ุฃุนูุงู ุงูููุฏุงู -->
        <div id="workSection" class="tab-content fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-green-600 mr-3"></i>ุชุณุฌูู ููู ุนูู ุฌุฏูุฏ
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-user mr-2"></i>ุงุณู ุงูุฒุจูู
                        </label>
                        <input type="text" id="clientName" placeholder="ุงุจุญุซ ุฃู ุฃุถู ุงุณู ุฌุฏูุฏ" list="namesList"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                        <datalist id="namesList"></datalist>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-calendar mr-2"></i>ุงูุชุงุฑูุฎ
                        </label>
                        <input type="date" id="workDate"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-map-marker-alt mr-2"></i>ุงูููุงู
                        </label>
                        <input type="text" id="workLoc" placeholder="ุงููุฒุฑุนุฉ / ุงูููุทูุฉ"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-cogs mr-2"></i>ููุน ุงูุฎุฏูุฉ
                        </label>
                        <select id="serviceType"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                            <option>ุญุฑุงุซุฉ</option>
                            <option>ูุตุงุจูุฉ</option>
                            <option>ููู</option>
                            <option>ุชูุนูู</option>
                            <option>ุฏูุงูุฉ</option>
                            <option>ุฃุฎุฑู</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-clock mr-2"></i>ุนุฏุฏ ุงูุณุงุนุงุช
                        </label>
                        <input type="number" id="workHours" step="0.5" min="0.5" max="24" oninput="calculateTotal()"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tag mr-2"></i>ุณุนุฑ ุงูุณุงุนุฉ (ุฌููู)
                        </label>
                        <input type="number" id="hourPrice" min="0" oninput="calculateTotal()"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-money-check-alt mr-2"></i>ุญุงูุฉ ุงูุฏูุน
                        </label>
                        <select id="payStatus"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                            <option value="ููุฏู">ุฎุงูุต</option>
                            <option value="ุฃุฌู">ุฃุฌู (ุฏูู)</option>
                            <option value="ูุตู">ูุตู ุงููุจูุบ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-money-bill mr-2"></i>ุงููุจูุบ ุงูุฅุฌูุงูู
                        </label>
                        <input type="text" id="totalAmount" readonly
                               class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg font-bold text-green-600 text-lg">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-phone mr-2"></i>ูุงุชู ุงูุฒุจูู (ุงุฎุชูุงุฑู)
                    </label>
                    <input type="tel" id="clientPhone" placeholder="0123456789"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-sticky-note mr-2"></i>ููุงุญุธุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)
                    </label>
                    <textarea id="workNotes" rows="2" placeholder="ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition"></textarea>
                </div>
                
                <button onclick="addWork()" 
                        class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl flex items-center justify-center">
                    <i class="fas fa-save mr-3 text-xl"></i>
                    ุญูุธ ููู ุงูุนูู
                </button>
            </div>
            
            <!-- ุขุฎุฑ ุงูุนูููุงุช ุงููุณุฌูุฉ -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-history text-blue-600 mr-3"></i>ุขุฎุฑ ุงูุนูููุงุช ุงููุณุฌูุฉ
                </h3>
                <div id="recentWork" class="overflow-x-auto">
                    <!-- ุณูุชู ุชุนุจุฆุชูุง ุจุงูู JavaScript -->
                </div>
            </div>
        </div>

        <!-- ุชุจููุจ ุงููุตุงุฑูู -->
        <div id="expensesSection" class="tab-content hidden fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-orange-600 mr-3"></i>ุชุณุฌูู ูุตุฑูู ุฌุฏูุฏ
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-calendar mr-2"></i>ุงูุชุงุฑูุฎ
                        </label>
                        <input type="date" id="expDate"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tags mr-2"></i>ููุน ุงููุตุฑูู
                        </label>
                        <select id="expType"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                            <option value="ุฏูุฒู">โฝ  ุฌุงุฒ</option>
                            <option value="ุฒูุช">๐ข๏ธ ุฒูุช ูุญุฑู</option>
                            <option value="ุตูุงูุฉ">๐ง ุตูุงูุฉ</option>
                            <option value="ูุทุน ุบูุงุฑ">โ๏ธ ูุทุน ุบูุงุฑ</option>
                            <option value="ุนูุงู">๐ท ุฃุฌูุฑ ุนูุงู</option>
                            <option value="ุฃุฎุฑู">๐ ูุตุงุฑูู ุฃุฎุฑู</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-money-bill mr-2"></i>ุงููุจูุบ (ุฌููู)
                        </label>
                        <input type="number" id="expAmount" min="0" step="0.01"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-sticky-note mr-2"></i>ุชูุงุตูู ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)
                        </label>
                        <input type="text" id="expDetails" placeholder="ูุซุงู: 100 ูุชุฑ ุฌุงุฒ ูู ูุญุทุฉ..."
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                    </div>
                </div>
                
                <button onclick="addExpense()" 
                        class="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl flex items-center justify-center">
                    <i class="fas fa-plus-circle mr-3 text-xl"></i>
                    ุฅุถุงูุฉ ูุตุฑูู
                </button>
            </div>
            
            <!-- ูุงุฆูุฉ ุงููุตุงุฑูู -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-list-alt text-red-600 mr-3"></i>ุณุฌู ุงููุตุงุฑูู
                </h3>
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-medium text-gray-700">ุฅุฌูุงูู ุงููุตุงุฑูู: <span id="totalExpenses" class="text-red-600 font-bold">0</span> ุฏููุงุฑ</h4>
                    <button onclick="clearExpenses()" class="text-sm bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded-lg transition">
                        <i class="fas fa-trash-alt mr-1"></i>ุญุฐู ุงููู
                    </button>
                </div>
                <div id="expList" class="space-y-3 max-h-96 overflow-y-auto p-2">
                    <!-- ุณูุชู ุชุนุจุฆุชูุง ุจุงูู JavaScript -->
                </div>
            </div>
        </div>

        <!-- ุชุจููุจ ุณุฌู ุงูุฒุจุงุฆู -->
        <div id="historySection" class="tab-content hidden fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-users text-purple-600 mr-3"></i>ุณุฌู ุงูุฒุจุงุฆู
                    </h3>
                    
                    <div class="flex gap-2">
                        <div class="relative flex-1">
                            <input type="text" id="searchClient" placeholder="๐ ุจุญุซ ุจุงุณู ุงูุฒุจูู..." oninput="renderHistory()"
                                   class="w-full px-4 py-3 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition">
                            <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                        </div>
                        <button onclick="exportAllClients()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg transition">
                            <i class="fas fa-file-export"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                        <div class="text-blue-700 text-sm mb-1">ุฅุฌูุงูู ุงูุฒุจุงุฆู</div>
                        <div id="totalClients" class="text-2xl font-bold text-blue-800">0</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                        <div class="text-green-700 text-sm mb-1">ุฒุจุงุฆู ุณุฏุฏูุง ูุงูู ุงููุจูุบ</div>
                        <div id="paidClients" class="text-2xl font-bold text-green-800">0</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                        <div class="text-red-700 text-sm mb-1">ุฒุจุงุฆู ูุฏูููู</div>
                        <div id="debtClients" class="text-2xl font-bold text-red-800">0</div>
                    </div>
                </div>
                
                <div id="clientHistoryList" class="space-y-4">
                    <!-- ุณูุชู ุชุนุจุฆุชูุง ุจุงูู JavaScript -->
                </div>
            </div>
        </div>

        <!-- ุชุจููุจ ุงูุชูุงุฑูุฑ -->
        <div id="reportsSection" class="tab-content hidden fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-chart-bar text-blue-600 mr-3"></i>ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl">
                        <i class="fas fa-chart-line text-3xl mb-4"></i>
                        <h4 class="font-bold text-lg mb-2">ุชูุฑูุฑ ุงูุฃุนูุงู</h4>
                        <p class="text-blue-100 text-sm mb-4">ุชุญููู ุชูุตููู ูุฌููุน ุฃุนูุงู ุงูุชุฑุงูุชูุฑ</p>
                        <button onclick="generateWorkReport()" class="w-full bg-white text-blue-600 hover:bg-blue-50 font-bold py-2 px-4 rounded-lg transition">
                            ุนุฑุถ ุงูุชูุฑูุฑ
                        </button>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl">
                        <i class="fas fa-money-bill-wave text-3xl mb-4"></i>
                        <h4 class="font-bold text-lg mb-2">ุฃูุซุฑ ุงูุฒุจุงุฆู ุฏูุนุงู</h4>
                        <p class="text-green-100 text-sm mb-4">ูุงุฆูุฉ ุจุฃูุถู ุงูุฒุจุงุฆู ูู ุญูุซ ุงููุฏููุนุงุช</p>
                        <button onclick="generateTopClientsReport()" class="w-full bg-white text-green-600 hover:bg-green-50 font-bold py-2 px-4 rounded-lg transition">
                            ุนุฑุถ ุงูุชูุฑูุฑ
                        </button>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl">
                        <i class="fas fa-tractor text-3xl mb-4"></i>
                        <h4 class="font-bold text-lg mb-2">ุฃูุซุฑ ุงูุฎุฏูุงุช ุฑุจุญูุฉ</h4>
                        <p class="text-purple-100 text-sm mb-4">ุชุญููู ุงูุฎุฏูุงุช ุงูุฃูุซุฑ ุฑุจุญูุฉ</p>
                        <button onclick="generateServiceReport()" class="w-full bg-white text-purple-600 hover:bg-purple-50 font-bold py-2 px-4 rounded-lg transition">
                            ุนุฑุถ ุงูุชูุฑูุฑ
                        </button>
                    </div>
                </div>
                
                <div id="reportContent" class="space-y-6">
                    <!-- ูุญุชูู ุงูุชูุงุฑูุฑ ุณูุชู ุชุนุจุฆุชู ููุง -->
                </div>
            </div>
        </div>

        <!-- ุชุจููุจ ุงููุณุฎ ุงูุงุญุชูุงุทู -->
        <div id="backupSection" class="tab-content hidden fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-4">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-database text-green-600 mr-3"></i>ูุธุงู ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- ุชุตุฏูุฑ ุงูุจูุงูุงุช -->
                    <div class="border-2 border-gray-200 rounded-xl p-5 hover:border-blue-300 transition">
                        <h4 class="font-bold text-lg mb-4 text-gray-700">
                            <i class="fas fa-download text-blue-600 mr-2"></i>ุชุตุฏูุฑ ุงูุจูุงูุงุช
                        </h4>
                        <p class="text-gray-600 mb-4 text-sm">
                            ูู ุจุชุญููู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุฌููุน ุจูุงูุงุชู ูุชุฎุฒูููุง ุจุฃูุงู ุนูู ุฌูุงุฒู.
                        </p>
                        <button onclick="exportData()" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center mb-3">
                            <i class="fas fa-file-export mr-2"></i>ุชุตุฏูุฑ ูููู JSON
                        </button>
                        <button onclick="exportCSV()" 
                                class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center">
                            <i class="fas fa-file-csv mr-2"></i>ุชุตุฏูุฑ ูููู Excel
                        </button>
                    </div>
                    
                    <!-- ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช -->
                    <div class="border-2 border-gray-200 rounded-xl p-5 hover:border-purple-300 transition">
                        <h4 class="font-bold text-lg mb-4 text-gray-700">
                            <i class="fas fa-upload text-purple-600 mr-2"></i>ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช
                        </h4>
                        <p class="text-gray-600 mb-4 text-sm">
                            ุงุณุชุฑุฌุน ุงูุจูุงูุงุช ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุณุงุจูุฉ ุฃู ูู ุฌูุงุฒ ุขุฎุฑ.
                        </p>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-medium mb-2">ุงุฎุชุฑ ููู ุงููุณุฎ ุงูุงุญุชูุงุทู</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-purple-400 transition cursor-pointer"
                                 onclick="document.getElementById('importFile').click()">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                <p class="text-gray-500 text-sm">ุงููุฑ ูุงุฎุชูุงุฑ ููู ุฃู ุงุณุญุจ ุงูููู ููุง</p>
                                <p class="text-gray-400 text-xs mt-1">ูุฌุจ ุฃู ูููู ุงูููู ุจุตูุบุฉ JSON</p>
                                <input type="file" id="importFile" accept=".json,.txt" class="hidden">
                            </div>
                            <div id="selectedFileName" class="text-sm text-gray-600 mt-2 text-center"></div>
                        </div>
                        <button onclick="importData()" 
                                class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center">
                            <i class="fas fa-file-import mr-2"></i>ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช
                        </button>
                    </div>
                </div>
                
                <!-- ุฅุญุตุงุฆูุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู -->
                <div class="mt-8 p-5 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl">
                    <h4 class="font-bold text-lg mb-4 text-gray-700">ูุนูููุงุช ุงูุชุฎุฒูู ูุงูุฅุญุตุงุฆูุงุช</h4>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div class="text-center p-4 bg-white rounded-lg shadow">
                            <div class="text-2xl font-bold text-blue-600" id="backupCount">0</div>
                            <div class="text-sm text-gray-500">ุนุฏุฏ ุงูุณุฌูุงุช</div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg shadow">
                            <div class="text-2xl font-bold text-green-600" id="storageSize">0 KB</div>
                            <div class="text-sm text-gray-500">ุญุฌู ุงูุชุฎุฒูู</div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg shadow">
                            <div class="text-2xl font-bold text-purple-600" id="lastBackup">---</div>
                            <div class="text-sm text-gray-500">ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg shadow">
                            <div class="text-2xl font-bold text-orange-600" id="autoBackups">0</div>
                            <div class="text-sm text-gray-500">ูุณุฎ ุชููุงุฆูุฉ</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 bg-white p-4 rounded-lg">
                        <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                        ูุชู ุชุฎุฒูู ุงูุจูุงูุงุช ูุญููุงู ูู ูุชุตูุญู. ูู ุจุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุฏูุฑูุงู ูุญูุงูุฉ ุจูุงูุงุชู ูู ุงูููุฏุงู.
                        <button onclick="toggleAutoBackup()" id="autoBackupToggle" class="mr-2 text-blue-600 hover:text-blue-800 font-medium">
                            <i class="fas fa-robot mr-1"></i>ุชูุนูู ุงููุณุฎ ุงูุชููุงุฆู
                        </button>
                    </div>
                </div>
                
                <!-- ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงููุญููุธุฉ -->
                <div class="mt-6 p-5 bg-white rounded-xl shadow">
                    <h4 class="font-bold text-lg mb-4 text-gray-700">
                        <i class="fas fa-history text-gray-600 mr-2"></i>ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงููุญููุธุฉ
                    </h4>
                    <div id="savedBackups" class="space-y-3 max-h-60 overflow-y-auto p-2">
                        <!-- ุณูุชู ุชุนุจุฆุชูุง ุจุงูู JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุชูุงุตูู ุงูุฒุจูู -->
    <div id="clientDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" id="modalClientName">ุชูุงุตูู ุงูุฒุจูู</h3>
                    <button onclick="closeClientModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]" id="modalClientContent">
                <!-- ุณูุชู ุชุนุจุฆุชูุง ุจุงูู JavaScript -->
            </div>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุชุนุฏูู ุงูุฒุจูู -->
    <div id="editClientModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" id="editModalTitle">ุชุนุฏูู ุจูุงูุงุช ุงูุฒุจูู</h3>
                    <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]" id="editClientContent">
                <!-- ุณูุชู ุชุนุจุฆุชูุง ุจุงูู JavaScript -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-6 mt-8">
        <div class="container mx-auto text-center">
            <p class="mb-2">๐ <span class="font-bold">ูุญุงุณุจ ุงูุชุฑุงูุชูุฑ ุงูุฒุฑุงุนู</span> - ูุธุงู ูุญุงุณุจุฉ ูุชูุงูู ูุณุงุฆู ุงูุชุฑุงูุชูุฑ</p>
            <p class="text-gray-400 text-sm">ยฉ 2025 ุฌููุน ุงูุญููู ูุญููุธุฉ |ุชุตููู :ููุฑุบูู ุฃุจูุงููุงุณู | ูุนูู ุฏูู ุงุชุตุงู ุจุงูุฅูุชุฑูุช</p>
            <div class="mt-4 flex justify-center space-x-4 space-x-reverse">
                <a href="#" class="text-gray-300 hover:text-white transition">
                    <i class="fab fa-whatsapp"></i>
                </a>
                <a href="#" class="text-gray-300 hover:text-white transition">
                    <i class="fas fa-phone"></i>
                </a>
                <a href="#" class="text-gray-300 hover:text-white transition">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>
        </div>
    </footer>

    <script>
        // ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
        let data = JSON.parse(localStorage.getItem('tractor_final_db')) || { work: [], expenses: [] };
        let autoBackupEnabled = localStorage.getItem('auto_backup_enabled') === 'true';
        let editingClientName = '';

        // ุชููุฆุฉ ุงูุชูุงุฑูุฎ
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('workDate').value = today;
            document.getElementById('expDate').value = today;
            
            updateDashboard();
            updateBackupStats();
            renderRecentWork();
            initTabs();
            setupEventListeners();
            
            // ุชูุนูู ุงููุณุฎ ุงูุชููุงุฆู ุฅุฐุง ูุงู ููุนู
            if (autoBackupEnabled) {
                document.getElementById('autoBackupToggle').innerHTML = '<i class="fas fa-robot mr-1"></i>ุฅููุงู ุงููุณุฎ ุงูุชููุงุฆู';
                autoBackup();
            }
        });

        // ุฏุงูุฉ ุชุจุฏูู ุงูุชุจููุจุงุช
        function switchTab(tab) {
            // ุฅุฎูุงุก ุฌููุน ุงููุญุชููุงุช
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
                content.classList.remove('fade-in');
            });
            
            // ุฅุฒุงูุฉ ุงููุดุงุท ูู ุฌููุน ุงูุฃุฒุฑุงุฑ
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.remove('bg-green-600', 'text-white');
                btn.classList.add('text-gray-600');
            });
            
            // ุฅุธูุงุฑ ุงููุญุชูู ุงููุทููุจ
            document.getElementById(tab + 'Section').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById(tab + 'Section').classList.add('fade-in');
            }, 10);
            
            // ุชูุนูู ุงูุฒุฑ ุงููุญุฏุฏ
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('tab-active');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('bg-green-600', 'text-white');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('text-gray-600');
            
            // ุชุญููู ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูู ุชุจููุจ
            if (tab === 'history') {
                renderHistory();
                updateClientStats();
            } else if (tab === 'expenses') {
                renderExpenses();
            } else if (tab === 'reports') {
                generateGeneralReport();
            } else if (tab === 'backup') {
                updateBackupStats();
                renderSavedBackups();
            }
        }

        // ุฏุงูุฉ ุฅุถุงูุฉ ุนูู ุฌุฏูุฏ
        function addWork() {
            const entry = {
                id: Date.now(),
                name: document.getElementById('clientName').value.trim(),
                date: document.getElementById('workDate').value,
                location: document.getElementById('workLoc').value,
                service: document.getElementById('serviceType').value,
                hours: parseFloat(document.getElementById('workHours').value) || 0,
                price: parseFloat(document.getElementById('hourPrice').value) || 0,
                payStatus: document.getElementById('payStatus').value,
                phone: document.getElementById('clientPhone').value,
                notes: document.getElementById('workNotes').value,
                timestamp: new Date().toISOString()
            };

            // ุงูุชุญูู ูู ุงูุจูุงูุงุช
            if (!entry.name || entry.name.length < 2) {
                showNotification('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงูุฒุจูู', 'error');
                document.getElementById('clientName').focus();
                return;
            }
            
            if (!entry.hours || entry.hours <= 0) {
                showNotification('ูุฑุฌู ุฅุฏุฎุงู ุนุฏุฏ ุณุงุนุงุช ุตุญูุญ', 'error');
                document.getElementById('workHours').focus();
                return;
            }
            
            if (!entry.price || entry.price <= 0) {
                showNotification('ูุฑุฌู ุฅุฏุฎุงู ุณุนุฑ ุณุงุนุฉ ุตุญูุญ', 'error');
                document.getElementById('hourPrice').focus();
                return;
            }

            data.work.push(entry);
            save();
            
            // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
            document.getElementById('clientName').value = '';
            document.getElementById('workHours').value = '';
            document.getElementById('hourPrice').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('workNotes').value = '';
            document.getElementById('totalAmount').value = '0';
            
            showNotification('ุชู ุญูุธ ููู ุงูุนูู ุจูุฌุงุญ!', 'success');
            updateDashboard();
            renderRecentWork();
            
            // ุฅุฐุง ูุงู ุงูุชุจููุจ ุงููุดุท ูู ุณุฌู ุงูุฒุจุงุฆูุ ูู ุจุชุญุฏูุซู
            if (!document.getElementById('historySection').classList.contains('hidden')) {
                renderHistory();
            }
        }

        // ุฏุงูุฉ ุฅุถุงูุฉ ูุตุฑูู
        function addExpense() {
            const exp = {
                id: Date.now(),
                date: document.getElementById('expDate').value,
                type: document.getElementById('expType').value,
                amount: parseFloat(document.getElementById('expAmount').value) || 0,
                details: document.getElementById('expDetails').value,
                timestamp: new Date().toISOString()
            };
            
            if (!exp.amount || exp.amount <= 0) {
                showNotification('ูุฑุฌู ุฅุฏุฎุงู ูุจูุบ ุงููุตุฑูู', 'error');
                return;
            }
            
            data.expenses.push(exp);
            save();
            
            // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
            document.getElementById('expAmount').value = '';
            document.getElementById('expDetails').value = '';
            
            showNotification('ุชู ุฅุถุงูุฉ ุงููุตุฑูู ุจูุฌุงุญ!', 'success');
            updateDashboard();
            renderExpenses();
        }

        // ุฏุงูุฉ ุญูุธ ุงูุจูุงูุงุช
        function save() {
            localStorage.setItem('tractor_final_db', JSON.stringify(data));
            updateDashboard();
            
            // ูุณุฎ ุงุญุชูุงุทู ุชููุงุฆู ุฅุฐุง ูุงู ููุนู
            if (autoBackupEnabled) {
                autoBackup();
            }
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ููุญุฉ ุงูุฅุญุตุงุฆูุงุช
        function updateDashboard() {
            const income = data.work.reduce((s, w) => s + (w.hours * w.price), 0);
            const expenses = data.expenses.reduce((s, e) => s + e.amount, 0);
            
            document.getElementById('statIncome').innerText = income.toLocaleString();
            document.getElementById('statExpense').innerText = expenses.toLocaleString();
            document.getElementById('statNet').innerText = (income - expenses).toLocaleString();
            
            // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุฃุณูุงุก ุงูููุชุฑุญุฉ
            const names = [...new Set(data.work.map(w => w.name))];
            document.getElementById('namesList').innerHTML = names.map(n => `<option value="${n}">`).join('');
            
            // ุชุญุฏูุซ ุฅุฌูุงูู ุงููุตุงุฑูู ูู ุชุจููุจ ุงููุตุงุฑูู
            document.getElementById('totalExpenses').innerText = expenses.toLocaleString();
        }

        // ุฏุงูุฉ ุญุณุงุจ ุงููุจูุบ ุงูุฅุฌูุงูู
        function calculateTotal() {
            const hours = parseFloat(document.getElementById('workHours').value) || 0;
            const price = parseFloat(document.getElementById('hourPrice').value) || 0;
            const total = hours * price;
            
            document.getElementById('totalAmount').value = total.toLocaleString();
        }

        // ุฏุงูุฉ ุนุฑุถ ุขุฎุฑ ุงูุนูููุงุช
        function renderRecentWork() {
            const container = document.getElementById('recentWork');
            const recentWork = data.work.slice(-5).reverse();
            
            if (recentWork.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p>ูุง ุชูุฌุฏ ุนูููุงุช ูุณุฌูุฉ ุจุนุฏ</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="overflow-x-auto">
                    <table class="min-w-full table-auto table-striped table-hover">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-right">ุงูุฒุจูู</th>
                                <th class="px-4 py-3 text-right">ุงูุฎุฏูุฉ</th>
                                <th class="px-4 py-3 text-right">ุงูุณุงุนุงุช</th>
                                <th class="px-4 py-3 text-right">ุงููุจูุบ</th>
                                <th class="px-4 py-3 text-right">ุงูุญุงูุฉ</th>
                                <th class="px-4 py-3 text-right">ุงูุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            recentWork.forEach(work => {
                const total = work.hours * work.price;
                const statusColor = work.payStatus === 'ุฃุฌู' ? 'bg-red-100 text-red-800' : 
                                  work.payStatus === 'ูุตู' ? 'bg-yellow-100 text-yellow-800' : 
                                  'bg-green-100 text-green-800';
                
                html += `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-4 py-3 border-b">${work.name}</td>
                        <td class="px-4 py-3 border-b">${work.service}</td>
                        <td class="px-4 py-3 border-b">${work.hours}</td>
                        <td class="px-4 py-3 border-b font-bold">${total.toLocaleString()}</td>
                        <td class="px-4 py-3 border-b">
                            <span class="px-2 py-1 rounded-full text-xs ${statusColor}">
                                ${work.payStatus}
                            </span>
                        </td>
                        <td class="px-4 py-3 border-b">
                            <div class="flex space-x-2 space-x-reverse">
                                <button onclick="editWorkEntry(${work.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteWorkEntry(${work.id})" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ุฏุงูุฉ ุชุนุฏูู ุณุฌู ุนูู
        function editWorkEntry(id) {
            const work = data.work.find(w => w.id === id);
            if (!work) return;
            
            editingClientName = work.name;
            
            document.getElementById('editModalTitle').innerText = `ุชุนุฏูู ุณุฌู ุนูู ูู ${work.name}`;
            document.getElementById('editClientContent').innerHTML = `
                <form onsubmit="updateWorkEntry(${id}); return false;">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงุณู ุงูุฒุจูู</label>
                            <input type="text" id="editClientName" value="${work.name}" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุชุงุฑูุฎ</label>
                            <input type="date" id="editWorkDate" value="${work.date}" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ููุน ุงูุฎุฏูุฉ</label>
                            <select id="editServiceType" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                                <option ${work.service === 'ุญุฑุงุซุฉ' ? 'selected' : ''}>ุญุฑุงุซุฉ</option>
                                <option ${work.service === 'ูุตุงุจูุฉ' ? 'selected' : ''}>ูุตุงุจูุฉ</option>
                                <option ${work.service === 'ููู' ? 'selected' : ''}>ููู</option>
                                <option ${work.service === 'ุชูุนูู' ? 'selected' : ''}>ุชูุนูู</option>
                                <option ${work.service === 'ุฏูุงูุฉ' ? 'selected' : ''}>ุฏูุงูุฉ</option>
                                <option ${work.service === 'ุฃุฎุฑู' ? 'selected' : ''}>ุฃุฎุฑู</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุญุงูุฉ ุงูุฏูุน</label>
                            <select id="editPayStatus" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                                <option value="ููุฏู" ${work.payStatus === 'ููุฏู' ? 'selected' : ''}>ุฎุงูุต</option>
                                <option value="ุฃุฌู" ${work.payStatus === 'ุฃุฌู' ? 'selected' : ''}>ุฃุฌู (ุฏูู)</option>
                                <option value="ูุตู" ${work.payStatus === 'ูุตู' ? 'selected' : ''}>ูุตู ุงููุจูุบ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุนุฏุฏ ุงูุณุงุนุงุช</label>
                            <input type="number" id="editWorkHours" value="${work.hours}" step="0.5" min="0.5" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุณุนุฑ ุงูุณุงุนุฉ (ุฌููู)</label>
                            <input type="number" id="editHourPrice" value="${work.price}" min="0" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงูููุงู</label>
                            <input type="text" id="editWorkLoc" value="${work.location || ''}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ูุงุชู ุงูุฒุจูู</label>
                            <input type="tel" id="editClientPhone" value="${work.phone || ''}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
                        <textarea id="editWorkNotes" rows="3"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">${work.notes || ''}</textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-3 space-x-reverse">
                        <button type="button" onclick="closeEditModal()" 
                                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                            ุฅูุบุงุก
                        </button>
                        <button type="submit" 
                                class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            ุญูุธ ุงูุชุนุฏููุงุช
                        </button>
                    </div>
                </form>
            `;
            
            document.getElementById('editClientModal').classList.remove('hidden');
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุณุฌู ุนูู
        function updateWorkEntry(id) {
            const index = data.work.findIndex(w => w.id === id);
            if (index === -1) return;
            
            data.work[index] = {
                ...data.work[index],
                name: document.getElementById('editClientName').value.trim(),
                date: document.getElementById('editWorkDate').value,
                service: document.getElementById('editServiceType').value,
                payStatus: document.getElementById('editPayStatus').value,
                hours: parseFloat(document.getElementById('editWorkHours').value),
                price: parseFloat(document.getElementById('editHourPrice').value),
                location: document.getElementById('editWorkLoc').value,
                phone: document.getElementById('editClientPhone').value,
                notes: document.getElementById('editWorkNotes').value,
                timestamp: new Date().toISOString()
            };
            
            save();
            closeEditModal();
            renderRecentWork();
            renderHistory();
            showNotification('ุชู ุชุญุฏูุซ ุณุฌู ุงูุนูู ุจูุฌุงุญ', 'success');
        }

        // ุฏุงูุฉ ุญุฐู ุณุฌู ุนูู
        function deleteWorkEntry(id) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุณุฌูุ')) {
                data.work = data.work.filter(w => w.id !== id);
                save();
                renderRecentWork();
                renderHistory();
                showNotification('ุชู ุญุฐู ุณุฌู ุงูุนูู', 'success');
            }
        }

        // ุฏุงูุฉ ุฅุบูุงู ูุงูุฐุฉ ุงูุชุนุฏูู
        function closeEditModal() {
            document.getElementById('editClientModal').classList.add('hidden');
            editingClientName = '';
        }

        // ุฏุงูุฉ ุนุฑุถ ุงููุตุงุฑูู
        function renderExpenses() {
            const container = document.getElementById('expList');
            const recentExpenses = data.expenses.slice().reverse();
            
            if (recentExpenses.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-8 text-gray-500">
                        <i class="fas fa-gas-pump text-4xl mb-4"></i>
                        <p>ูุง ุชูุฌุฏ ูุตุงุฑูู ูุณุฌูุฉ</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            recentExpenses.forEach(exp => {
                const icon = exp.type === 'ุฌุงุฒ' ? 'โฝ' :
                           exp.type === 'ุฒูุช' ? '๐ข๏ธ' :
                           exp.type === 'ุตูุงูุฉ' ? '๐ง' :
                           exp.type === 'ูุทุน ุบูุงุฑ' ? 'โ๏ธ' :
                           exp.type === 'ุนูุงู' ? '๐ท' : '๐';
                
                html += `
                    <div class="flex items-center justify-between p-4 bg-white border border-gray-200 rounded-xl hover:shadow-md transition">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <div class="text-2xl">${icon}</div>
                            <div>
                                <div class="font-medium">${exp.type}</div>
                                <div class="text-sm text-gray-500">${exp.date} ${exp.details ? 'โข ' + exp.details : ''}</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4 space-x-reverse">
                            <span class="text-lg font-bold text-red-600">${exp.amount.toLocaleString()}</span>
                            <button onclick="deleteExpense(${exp.id})" class="text-gray-400 hover:text-red-500 transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ุฏุงูุฉ ุญุฐู ูุตุฑูู
        function deleteExpense(id) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงููุตุฑููุ')) {
                data.expenses = data.expenses.filter(exp => exp.id !== id);
                save();
                renderExpenses();
                showNotification('ุชู ุญุฐู ุงููุตุฑูู', 'success');
            }
        }

        // ุฏุงูุฉ ุญุฐู ุฌููุน ุงููุตุงุฑูู
        function clearExpenses() {
            if (data.expenses.length === 0) {
                showNotification('ูุง ุชูุฌุฏ ูุตุงุฑูู ูุญุฐููุง', 'info');
                return;
            }
            
            if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ุงููุตุงุฑูู (${data.expenses.length} ูุตุฑูู)?`)) {
                data.expenses = [];
                save();
                renderExpenses();
                showNotification('ุชู ุญุฐู ุฌููุน ุงููุตุงุฑูู', 'success');
            }
        }

        // ุฏุงูุฉ ุนุฑุถ ุณุฌู ุงูุฒุจุงุฆู (ูุญุณูุฉ)
        function renderHistory() {
            const query = document.getElementById('searchClient').value.toLowerCase();
            const container = document.getElementById('clientHistoryList');
            
            // ุชุฌููุน ุงูุนูู ุญุณุจ ุงุณู ุงูุฒุจูู
            const grouped = data.work.reduce((acc, curr) => {
                if (!acc[curr.name]) {
                    acc[curr.name] = {
                        items: [],
                        phone: curr.phone,
                        total: 0,
                        paid: 0,
                        debt: 0,
                        lastDate: curr.date,
                        firstDate: curr.date,
                        services: {}
                    };
                }
                acc[curr.name].items.push(curr);
                
                const itemTotal = curr.hours * curr.price;
                acc[curr.name].total += itemTotal;
                
                // ุญุณุงุจ ุงููุจูุบ ุงููุฏููุน ูุงููุชุจูู ุจุฏูุฉ
                if (curr.payStatus === 'ููุฏู') {
                    acc[curr.name].paid += itemTotal;
                } else if (curr.payStatus === 'ูุตู') {
                    acc[curr.name].paid += itemTotal / 2;
                    acc[curr.name].debt += itemTotal / 2;
                } else { // ุฃุฌู
                    acc[curr.name].debt += itemTotal;
                }
                
                // ุชุชุจุน ุงูุฎุฏูุงุช
                if (!acc[curr.name].services[curr.service]) {
                    acc[curr.name].services[curr.service] = 0;
                }
                acc[curr.name].services[curr.service] += itemTotal;
                
                // ุชุญุฏูุซ ุงูุชูุงุฑูุฎ
                if (curr.date > acc[curr.name].lastDate) {
                    acc[curr.name].lastDate = curr.date;
                }
                if (curr.date < acc[curr.name].firstDate) {
                    acc[curr.name].firstDate = curr.date;
                }
                
                return acc;
            }, {});
            
            // ุชุญููู ุฅูู ูุตูููุฉ ูุชุฑุชูุจ ุญุณุจ ุชุงุฑูุฎ ุขุฎุฑ ูุนุงููุฉ
            const clientsArray = Object.keys(grouped)
                .filter(name => name.toLowerCase().includes(query))
                .map(name => ({
                    name,
                    ...grouped[name]
                }))
                .sort((a, b) => new Date(b.lastDate) - new Date(a.lastDate));
            
            if (clientsArray.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-12 text-gray-500">
                        <i class="fas fa-users text-4xl mb-4"></i>
                        <p>${query ? 'ูุง ุชูุฌุฏ ูุชุงุฆุฌ ููุจุญุซ' : 'ูุง ุชูุฌุฏ ุนููุงุก ูุณุฌููู ุจุนุฏ'}</p>
                        ${query ? '<p class="text-sm mt-2">ุฌุฑุจ ุงูุจุญุซ ุจุงุณู ุขุฎุฑ</p>' : ''}
                    </div>
                `;
                return;
            }
            
            let html = '';
            clientsArray.forEach(client => {
                const debtPercentage = client.total > 0 ? Math.round((client.debt / client.total) * 100) : 0;
                const paidPercentage = client.total > 0 ? Math.round((client.paid / client.total) * 100) : 0;
                const topService = Object.entries(client.services)
                    .sort((a, b) => b[1] - a[1])[0] || ['ูุง ุชูุฌุฏ', 0];
                
                html += `
                    <div class="client-card bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition">
                        <div class="p-5 border-b border-gray-100">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold text-lg text-gray-800 mb-2">${client.name}</h4>
                                    <div class="flex flex-wrap gap-3 mt-2">
                                        ${client.phone ? `
                                            <div class="flex items-center text-sm text-gray-600 bg-blue-50 px-3 py-1 rounded-full">
                                                <i class="fas fa-phone mr-2 text-blue-500"></i>
                                                ${client.phone}
                                            </div>
                                        ` : ''}
                                        <div class="flex items-center text-sm text-gray-600 bg-gray-50 px-3 py-1 rounded-full">
                                            <i class="fas fa-calendar mr-2 text-gray-500"></i>
                                            ุฃูู ูุนุงููุฉ: ${client.firstDate}
                                        </div>
                                        <div class="flex items-center text-sm text-gray-600 bg-gray-50 px-3 py-1 rounded-full">
                                            <i class="fas fa-calendar-check mr-2 text-gray-500"></i>
                                            ุขุฎุฑ ูุนุงููุฉ: ${client.lastDate}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex space-x-2 space-x-reverse">
                                    ${client.phone ? `
                                        <button onclick="window.open('tel:${client.phone}')" 
                                                class="bg-blue-100 hover:bg-blue-200 text-blue-700 p-3 rounded-full transition transform hover:scale-110">
                                            <i class="fas fa-phone"></i>
                                        </button>
                                    ` : ''}
                                    ${client.phone ? `
                                        <button onclick="shareClientWA('${client.name}')" 
                                                class="bg-green-100 hover:bg-green-200 text-green-700 p-3 rounded-full transition transform hover:scale-110">
                                            <i class="fab fa-whatsapp"></i>
                                        </button>
                                    ` : ''}
                                    <button onclick="viewClientDetails('${client.name}')" 
                                            class="bg-purple-100 hover:bg-purple-200 text-purple-700 p-3 rounded-full transition transform hover:scale-110">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button onclick="editClientDetails('${client.name}')" 
                                            class="bg-yellow-100 hover:bg-yellow-200 text-yellow-700 p-3 rounded-full transition transform hover:scale-110">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-5">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div class="text-center p-4 bg-gray-50 rounded-lg">
                                    <div class="text-sm text-gray-500 mb-1">ุฅุฌูุงูู ุงููุจูุบ</div>
                                    <div class="text-2xl font-bold text-gray-800">${client.total.toLocaleString()}</div>
                                    <div class="text-xs text-gray-400">ุฌููู</div>
                                </div>
                                <div class="text-center p-4 bg-green-50 rounded-lg">
                                    <div class="text-sm text-green-500 mb-1">ุงููุจูุบ ุงููุฏููุน</div>
                                    <div class="text-2xl font-bold text-green-600">${client.paid.toLocaleString()}</div>
                                    <div class="text-xs text-green-400">${paidPercentage}% ูู ุงูุฅุฌูุงูู</div>
                                </div>
                                <div class="text-center p-4 ${client.debt > 0 ? 'bg-red-50' : 'bg-green-100'} rounded-lg">
                                    <div class="text-sm ${client.debt > 0 ? 'text-red-500' : 'text-green-600'} mb-1">ุงููุจูุบ ุงููุชุจูู</div>
                                    <div class="text-2xl font-bold ${client.debt > 0 ? 'text-red-600' : 'text-green-700'}">
                                        ${client.debt.toLocaleString()}
                                    </div>
                                    <div class="text-xs ${client.debt > 0 ? 'text-red-400' : 'text-green-500'}">
                                        ${client.debt > 0 ? debtPercentage + '% ูู ุงูุฅุฌูุงูู' : 'ูุฏููุน ุจุงููุงูู โ'}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ุดุฑูุท ุงูุชูุฏู ููุฏูุน -->
                            <div class="mb-4">
                                <div class="flex justify-between text-sm text-gray-600 mb-1">
                                    <span>ูุนุฏู ุงูุฏูุน</span>
                                    <span>${paidPercentage}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill bg-green-500" style="width: ${paidPercentage}%"></div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <div class="text-sm text-blue-500 mb-1">ุนุฏุฏ ุงููุนุงููุงุช</div>
                                    <div class="text-xl font-bold text-blue-700">${client.items.length}</div>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <div class="text-sm text-purple-500 mb-1">ุงูุฎุฏูุฉ ุงูุฑุฆูุณูุฉ</div>
                                    <div class="text-xl font-bold text-purple-700">${topService[0]}</div>
                                    <div class="text-xs text-purple-400">${topService[1].toLocaleString()} ุฌููู</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateClientStats();
        }

        // ุฏุงูุฉ ุชุนุฏูู ุจูุงูุงุช ุงูุฒุจูู
        function editClientDetails(clientName) {
            editingClientName = clientName;
            const clientWork = data.work.filter(w => w.name === clientName);
            const clientPhone = clientWork[0]?.phone || '';
            
            document.getElementById('editModalTitle').innerText = `ุชุนุฏูู ุจูุงูุงุช ุงูุฒุจูู: ${clientName}`;
            document.getElementById('editClientContent').innerHTML = `
                <div class="space-y-6">
                    <div>
                        <h4 class="font-bold text-lg text-gray-700 mb-4">ุชุญุฏูุซ ุจูุงูุงุช ุงูุชูุงุตู</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุฑูู ุงููุงุชู</label>
                                <input type="tel" id="editClientPhoneGlobal" value="${clientPhone}"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงุณู ุงูุฒุจูู</label>
                                <input type="text" id="editClientNameGlobal" value="${clientName}"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-bold text-lg text-gray-700 mb-4">ุณุฌูุงุช ุงูุนูู (${clientWork.length} ุณุฌู)</h4>
                        <div class="space-y-3 max-h-60 overflow-y-auto p-3 bg-gray-50 rounded-lg">
                            ${clientWork.map((work, index) => `
                                <div class="bg-white p-3 rounded-lg border border-gray-200">
                                    <div class="flex justify-between items-center mb-2">
                                        <div>
                                            <span class="font-medium">${work.date}</span>
                                            <span class="text-sm text-gray-500 mr-2">- ${work.service}</span>
                                        </div>
                                        <div class="flex space-x-2 space-x-reverse">
                                            <button onclick="editWorkEntry(${work.id})" class="text-blue-600 hover:text-blue-800">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button onclick="updateWorkPayment(${work.id}, 'ููุฏู')" 
                                                    class="text-green-600 hover:text-green-800 ${work.payStatus === 'ููุฏู' ? 'hidden' : ''}">
                                                <i class="fas fa-check-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="text-sm text-gray-600">
                                        ${work.hours} ุณุงุนุฉ ร ${work.price} ุฌููู = 
                                        <span class="font-bold">${(work.hours * work.price).toLocaleString()}</span> ุฌููู
                                        <span class="mx-2">|</span>
                                        ุงูุญุงูุฉ: <span class="${work.payStatus === 'ููุฏู' ? 'text-green-600' : work.payStatus === 'ูุตู' ? 'text-yellow-600' : 'text-red-600'}">
                                            ${work.payStatus}
                                        </span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 space-x-reverse">
                        <button onclick="closeEditModal()" 
                                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                            ุฅูุบุงุก
                        </button>
                        <button onclick="saveClientEdits()" 
                                class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            ุญูุธ ุงูุชุนุฏููุงุช
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('editClientModal').classList.remove('hidden');
        }

        // ุฏุงูุฉ ุญูุธ ุชุนุฏููุงุช ุงูุฒุจูู
        function saveClientEdits() {
            const newName = document.getElementById('editClientNameGlobal').value.trim();
            const newPhone = document.getElementById('editClientPhoneGlobal').value;
            
            if (!newName) {
                showNotification('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุตุญูุญ ููุฒุจูู', 'error');
                return;
            }
            
            // ุชุญุฏูุซ ุฌููุน ุณุฌูุงุช ุงูุฒุจูู
            data.work.forEach(work => {
                if (work.name === editingClientName) {
                    work.name = newName;
                    if (newPhone) work.phone = newPhone;
                }
            });
            
            save();
            closeEditModal();
            renderHistory();
            showNotification('ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุฒุจูู ุจูุฌุงุญ', 'success');
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูุน
        function updateWorkPayment(id, status) {
            const index = data.work.findIndex(w => w.id === id);
            if (index === -1) return;
            
            data.work[index].payStatus = status;
            save();
            
            // ุชุญุฏูุซ ุงููุงูุฐุฉ ุงูุญุงููุฉ
            editClientDetails(editingClientName);
            showNotification('ุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูุน', 'success');
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูุฒุจุงุฆู
        function updateClientStats() {
            const grouped = data.work.reduce((acc, curr) => {
                if (!acc[curr.name]) {
                    acc[curr.name] = {
                        total: 0,
                        paid: 0,
                        debt: 0
                    };
                }
                
                const itemTotal = curr.hours * curr.price;
                acc[curr.name].total += itemTotal;
                
                if (curr.payStatus === 'ููุฏู') {
                    acc[curr.name].paid += itemTotal;
                } else if (curr.payStatus === 'ูุตู') {
                    acc[curr.name].paid += itemTotal / 2;
                    acc[curr.name].debt += itemTotal / 2;
                } else {
                    acc[curr.name].debt += itemTotal;
                }
                
                return acc;
            }, {});
            
            const clientNames = Object.keys(grouped);
            const paidClients = clientNames.filter(name => grouped[name].debt === 0).length;
            const debtClients = clientNames.filter(name => grouped[name].debt > 0).length;
            
            document.getElementById('totalClients').innerText = clientNames.length;
            document.getElementById('paidClients').innerText = paidClients;
            document.getElementById('debtClients').innerText = debtClients;
        }

        // ุฏุงูุฉ ุนุฑุถ ุชูุงุตูู ุงูุฒุจูู (ูุญุณูุฉ)
        function viewClientDetails(clientName) {
            const clientWork = data.work.filter(w => w.name === clientName);
            const clientPhone = clientWork[0]?.phone || 'ุบูุฑ ูุชููุฑ';
            
            let totalAmount = 0;
            let paidAmount = 0;
            let debtAmount = 0;
            
            let workRows = '';
            clientWork.forEach(work => {
                const workAmount = work.hours * work.price;
                totalAmount += workAmount;
                
                if (work.payStatus === 'ููุฏู') {
                    paidAmount += workAmount;
                } else if (work.payStatus === 'ูุตู') {
                    paidAmount += workAmount / 2;
                    debtAmount += workAmount / 2;
                } else {
                    debtAmount += workAmount;
                }
                
                const statusColor = work.payStatus === 'ุฃุฌู' ? 'red' : 
                                  work.payStatus === 'ูุตู' ? 'yellow' : 'green';
                
                workRows += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 border-b">${work.date}</td>
                        <td class="px-4 py-3 border-b">${work.service}</td>
                        <td class="px-4 py-3 border-b">${work.location || '-'}</td>
                        <td class="px-4 py-3 border-b">${work.hours} ุณุงุนุฉ</td>
                        <td class="px-4 py-3 border-b">${work.price}</td>
                        <td class="px-4 py-3 border-b font-bold">${workAmount.toLocaleString()}</td>
                        <td class="px-4 py-3 border-b">
                            <span class="px-2 py-1 rounded-full text-xs bg-${statusColor}-100 text-${statusColor}-800">
                                ${work.payStatus}
                            </span>
                        </td>
                        <td class="px-4 py-3 border-b">
                            <button onclick="editWorkEntry(${work.id})" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            document.getElementById('modalClientName').innerText = `ุชูุงุตูู ุงูุฒุจูู: ${clientName}`;
            document.getElementById('modalClientContent').innerHTML = `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-blue-50 p-4 rounded-xl">
                            <div class="text-blue-700 text-sm">ุฅุฌูุงูู ุงููุจูุบ</div>
                            <div class="text-2xl font-bold text-blue-800">${totalAmount.toLocaleString()} ุฌููู</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-xl">
                            <div class="text-green-700 text-sm">ุงููุจูุบ ุงููุฏููุน</div>
                            <div class="text-2xl font-bold text-green-800">${paidAmount.toLocaleString()} ุฌููู</div>
                        </div>
                        <div class="bg-red-50 p-4 rounded-xl">
                            <div class="text-red-700 text-sm">ุงููุจูุบ ุงููุชุจูู</div>
                            <div class="text-2xl font-bold text-red-800">${debtAmount.toLocaleString()} ุฌููู</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-xl">
                            <div class="text-purple-700 text-sm">ุนุฏุฏ ุงููุนุงููุงุช</div>
                            <div class="text-2xl font-bold text-purple-800">${clientWork.length}</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="font-bold text-gray-700">ูุนูููุงุช ุงูุงุชุตุงู</h5>
                            ${clientPhone !== 'ุบูุฑ ูุชููุฑ' ? `
                                <div class="flex space-x-2 space-x-reverse">
                                    <button onclick="window.open('tel:${clientPhone}')" 
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                                        <i class="fas fa-phone mr-2"></i>ุงุชุตุงู
                                    </button>
                                    <button onclick="shareClientWA('${clientName}')" 
                                            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                                        <i class="fab fa-whatsapp mr-2"></i>ูุงุชุณุงุจ
                                    </button>
                                    <button onclick="editClientDetails('${clientName}')" 
                                            class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg flex items-center">
                                        <i class="fas fa-edit mr-2"></i>ุชุนุฏูู
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                        <p><strong>ุงููุงุชู:</strong> ${clientPhone}</p>
                        <p><strong>ุฃูู ูุนุงููุฉ:</strong> ${clientWork[clientWork.length - 1]?.date}</p>
                        <p><strong>ุขุฎุฑ ูุนุงููุฉ:</strong> ${clientWork[0]?.date}</p>
                    </div>
                    
                    <div>
                        <h5 class="font-bold text-gray-700 mb-4">ุณุฌู ุงููุนุงููุงุช</h5>
                        <div class="overflow-x-auto">
                            <table class="min-w-full table-auto">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-4 py-3 text-right">ุงูุชุงุฑูุฎ</th>
                                        <th class="px-4 py-3 text-right">ุงูุฎุฏูุฉ</th>
                                        <th class="px-4 py-3 text-right">ุงูููุงู</th>
                                        <th class="px-4 py-3 text-right">ุงูุณุงุนุงุช</th>
                                        <th class="px-4 py-3 text-right">ุณุนุฑ ุงูุณุงุนุฉ</th>
                                        <th class="px-4 py-3 text-right">ุงููุจูุบ</th>
                                        <th class="px-4 py-3 text-right">ุงูุญุงูุฉ</th>
                                        <th class="px-4 py-3 text-right">ุชุนุฏูู</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${workRows}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('clientDetailModal').classList.remove('hidden');
        }

        // ุฏุงูุฉ ุฅุบูุงู ูุงูุฐุฉ ุชูุงุตูู ุงูุฒุจูู
        function closeClientModal() {
            document.getElementById('clientDetailModal').classList.add('hidden');
        }

        // ุฏุงูุฉ ูุดุงุฑูุฉ ุนุจุฑ ูุงุชุณุงุจ
        function shareClientWA(clientName) {
            const clientWork = data.work.filter(w => w.name === clientName);
            const clientPhone = clientWork[0]?.phone;
            
            if (!clientPhone) {
                showNotification('ูุง ููุฌุฏ ุฑูู ูุงุชู ููุฐุง ุงูุฒุจูู', 'error');
                return;
            }
            
            let totalAmount = 0;
            let debtAmount = 0;
            
            let msg = `*ูุดู ุญุณุงุจ ุงูุชุฑุงูุชูุฑ*%0A%0A`;
            msg += `*ุงุณู ุงูุฒุจูู:* ${clientName}%0A`;
            msg += `*ุงูุชุงุฑูุฎ:* ${new Date().toLocaleDateString('ar-SA')}%0A`;
            msg += `โโโโโโโโโโโโโโโโโ%0A%0A`;
            msg += `*ุณุฌู ุงูุฃุนูุงู:*%0A`;
            
            clientWork.forEach((work, index) => {
                const workAmount = work.hours * work.price;
                totalAmount += workAmount;
                
                if (work.payStatus !== 'ููุฏู') {
                    debtAmount += work.payStatus === 'ูุตู' ? workAmount / 2 : workAmount;
                }
                
                msg += `${index + 1}. ${work.date} - ${work.service} (${work.hours} ุณุงุนุฉ) = ${workAmount} ุฌููู`;
                msg += work.payStatus !== 'ููุฏู' ? ` (${work.payStatus})` : '';
                msg += `%0A`;
            });
            
            msg += `%0Aโโโโโโโโโโโโโโโโโ%0A`;
            msg += `*ุงูุฅุฌูุงูู:* ${totalAmount.toLocaleString()} ุฌููู%0A`;
            
            if (debtAmount > 0) {
                msg += `*ุงููุจูุบ ุงููุชุจูู:* ${debtAmount.toLocaleString()} ุฌููู%0A`;
                msg += `โโโโโโโโโโโโโโโโโ%0A`;
                msg += `*ูุฑุฌู ุชุณุฏูุฏ ุงููุจูุบ ุงููุชุจูู*%0A`;
            } else {
                msg += `*ุชู ุชุณุฏูุฏ ูุงูู ุงููุจูุบ* โ%0A`;
            }
            
            msg += `%0Aุดูุฑุงู ูุชุนุงูููู ูุนูุง ๐พ`;
            
            window.open(`https://wa.me/${clientPhone}?text=${msg}`);
        }

        // ุฏุงูุฉ ุชุตุฏูุฑ ุฌููุน ุงูุฒุจุงุฆู
        function exportAllClients() {
            if (data.work.length === 0) {
                showNotification('ูุง ุชูุฌุฏ ุจูุงูุงุช ููุชุตุฏูุฑ', 'error');
                return;
            }
            
            exportCSV();
        }

        // ========== ุงูุชูุงุฑูุฑ ==========
        
        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุนุงู
        function generateGeneralReport() {
            const container = document.getElementById('reportContent');
            
            if (data.work.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-12 text-gray-500">
                        <i class="fas fa-chart-bar text-4xl mb-4"></i>
                        <p>ูุง ุชูุฌุฏ ุจูุงูุงุช ูุงููุฉ ูุฅูุดุงุก ุงูุชูุงุฑูุฑ</p>
                        <p class="text-sm mt-2">ูู ุจุฅุถุงูุฉ ุจุนุถ ุงูุฃุนูุงู ุฃููุง</p>
                    </div>
                `;
                return;
            }
            
            // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
            const totalIncome = data.work.reduce((sum, w) => sum + (w.hours * w.price), 0);
            const totalExpenses = data.expenses.reduce((sum, e) => sum + e.amount, 0);
            const netProfit = totalIncome - totalExpenses;
            
            // ุฅุญุตุงุฆูุงุช ุงูุฎุฏูุงุช
            const serviceStats = data.work.reduce((acc, w) => {
                const amount = w.hours * w.price;
                if (!acc[w.service]) {
                    acc[w.service] = { count: 0, amount: 0 };
                }
                acc[w.service].count++;
                acc[w.service].amount += amount;
                return acc;
            }, {});
            
            // ุฅุญุตุงุฆูุงุช ุงูุฒุจุงุฆู
            const clientStats = data.work.reduce((acc, w) => {
                const amount = w.hours * w.price;
                if (!acc[w.name]) {
                    acc[w.name] = { count: 0, amount: 0, paid: 0 };
                }
                acc[w.name].count++;
                acc[w.name].amount += amount;
                
                if (w.payStatus === 'ููุฏู') {
                    acc[w.name].paid += amount;
                } else if (w.payStatus === 'ูุตู') {
                    acc[w.name].paid += amount / 2;
                }
                return acc;
            }, {});
            
            // ุชุญููู ุฅูู ูุตูููุงุช
            const serviceArray = Object.entries(serviceStats)
                .map(([name, stats]) => ({ name, ...stats }))
                .sort((a, b) => b.amount - a.amount);
            
            const clientArray = Object.entries(clientStats)
                .map(([name, stats]) => ({ name, ...stats }))
                .sort((a, b) => b.amount - a.amount);
            
            // ุชูููู HTML
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl">
                        <div class="text-3xl font-bold mb-2">${totalIncome.toLocaleString()}</div>
                        <div class="text-blue-100">ุฅุฌูุงูู ุงูุฏุฎู</div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl">
                        <div class="text-3xl font-bold mb-2">${netProfit.toLocaleString()}</div>
                        <div class="text-green-100">ุตุงูู ุงูุฑุจุญ</div>
                    </div>
                    <div class="bg-gradient-to-r from-red-500 to-red-600 text-white p-6 rounded-xl">
                        <div class="text-3xl font-bold mb-2">${totalExpenses.toLocaleString()}</div>
                        <div class="text-red-100">ุฅุฌูุงูู ุงููุตุงุฑูู</div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- ุฃูุซุฑ ุงูุฎุฏูุงุช ุฑุจุญูุฉ -->
                    <div class="bg-white p-6 rounded-xl shadow border border-gray-200">
                        <h4 class="font-bold text-lg text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-chart-pie text-blue-600 mr-2"></i>ุฃูุซุฑ ุงูุฎุฏูุงุช ุฑุจุญูุฉ
                        </h4>
                        <div class="space-y-3">
                            ${serviceArray.slice(0, 5).map((service, index) => {
                                const percentage = (service.amount / totalIncome * 100).toFixed(1);
                                return `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-gray-700 mr-3">${index + 1}</span>
                                            <div>
                                                <div class="font-medium">${service.name}</div>
                                                <div class="text-sm text-gray-500">${service.count} ุนูููุฉ</div>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-bold text-green-600">${service.amount.toLocaleString()} ุฌููู</div>
                                            <div class="text-sm text-gray-500">${percentage}%</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- ุฃูุซุฑ ุงูุฒุจุงุฆู ุฏูุนุงู -->
                    <div class="bg-white p-6 rounded-xl shadow border border-gray-200">
                        <h4 class="font-bold text-lg text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-users text-green-600 mr-2"></i>ุฃูุซุฑ ุงูุฒุจุงุฆู ุฏูุนุงู
                        </h4>
                        <div class="space-y-3">
                            ${clientArray.slice(0, 5).map((client, index) => {
                                const paymentRate = client.amount > 0 ? (client.paid / client.amount * 100).toFixed(1) : 0;
                                return `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-gray-700 mr-3">${index + 1}</span>
                                            <div>
                                                <div class="font-medium">${client.name}</div>
                                                <div class="text-sm text-gray-500">${client.count} ูุนุงููุฉ</div>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-bold text-blue-600">${client.amount.toLocaleString()} ุฌููู</div>
                                            <div class="text-sm ${paymentRate >= 100 ? 'text-green-600' : 'text-yellow-600'}">
                                                ${paymentRate}% ุฏูุน
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
                
                <!-- ุชูุฑูุฑ ุงูุฃุนูุงู ุงูุดุงูู -->
                <div class="mt-8 bg-white p-6 rounded-xl shadow border border-gray-200">
                    <h4 class="font-bold text-lg text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-file-alt text-purple-600 mr-2"></i>ุชูุฑูุฑ ุงูุฃุนูุงู ุงูุดุงูู
                    </h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full table-auto">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 text-right">ุงูุดูุฑ</th>
                                    <th class="px-4 py-3 text-right">ุนุฏุฏ ุงูุฃุนูุงู</th>
                                    <th class="px-4 py-3 text-right">ุฅุฌูุงูู ุงูุฏุฎู</th>
                                    <th class="px-4 py-3 text-right">ุงููุตุงุฑูู</th>
                                    <th class="px-4 py-3 text-right">ุตุงูู ุงูุฑุจุญ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${generateMonthlyReport()}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุดูุฑู
        function generateMonthlyReport() {
            const monthlyStats = {};
            
            data.work.forEach(work => {
                const month = work.date.substring(0, 7); // YYYY-MM
                const amount = work.hours * work.price;
                
                if (!monthlyStats[month]) {
                    monthlyStats[month] = {
                        workCount: 0,
                        income: 0
                    };
                }
                
                monthlyStats[month].workCount++;
                monthlyStats[month].income += amount;
            });
            
            data.expenses.forEach(exp => {
                const month = exp.date.substring(0, 7);
                
                if (!monthlyStats[month]) {
                    monthlyStats[month] = {
                        workCount: 0,
                        income: 0,
                        expenses: 0
                    };
                }
                
                if (!monthlyStats[month].expenses) {
                    monthlyStats[month].expenses = 0;
                }
                
                monthlyStats[month].expenses += exp.amount;
            });
            
            // ุชุญููู ุฅูู ูุตูููุฉ ูุชุฑุชูุจ ุชูุงุฒููุงู
            const months = Object.keys(monthlyStats).sort().reverse();
            
            return months.map(month => {
                const stats = monthlyStats[month];
                const expenses = stats.expenses || 0;
                const netProfit = stats.income - expenses;
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 border-b">${formatMonth(month)}</td>
                        <td class="px-4 py-3 border-b">${stats.workCount}</td>
                        <td class="px-4 py-3 border-b font-bold text-green-600">${stats.income.toLocaleString()}</td>
                        <td class="px-4 py-3 border-b font-bold text-red-600">${expenses.toLocaleString()}</td>
                        <td class="px-4 py-3 border-b font-bold ${netProfit >= 0 ? 'text-blue-600' : 'text-red-600'}">
                            ${netProfit.toLocaleString()}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ุฏุงูุฉ ุชูุณูู ุงูุดูุฑ
        function formatMonth(monthStr) {
            const [year, month] = monthStr.split('-');
            const months = [
                'ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู',
                'ููููู', 'ุฃุบุณุทุณ', 'ุณุจุชูุจุฑ', 'ุฃูุชูุจุฑ', 'ููููุจุฑ', 'ุฏูุณูุจุฑ'
            ];
            return `${months[parseInt(month) - 1]} ${year}`;
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุงูุฃุนูุงู
        function generateWorkReport() {
            const container = document.getElementById('reportContent');
            
            if (data.work.length === 0) {
                showNotification('ูุง ุชูุฌุฏ ุฃุนูุงู ูุณุฌูุฉ', 'info');
                return;
            }
            
            // ุญุณุงุจ ุฅุญุตุงุฆูุงุช ููุตูุฉ
            const totalJobs = data.work.length;
            const totalHours = data.work.reduce((sum, w) => sum + w.hours, 0);
            const avgHourPrice = data.work.reduce((sum, w) => sum + w.price, 0) / totalJobs;
            const avgHoursPerJob = totalHours / totalJobs;
            
            // ุฅุญุตุงุฆูุงุช ุญุงูุฉ ุงูุฏูุน
            const paymentStats = data.work.reduce((acc, w) => {
                acc[w.payStatus] = (acc[w.payStatus] || 0) + 1;
                return acc;
            }, {});
            
            let html = `
                <div class="bg-white p-6 rounded-xl shadow mb-6">
                    <h4 class="font-bold text-2xl text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-chart-line text-blue-600 mr-3"></i>ุชูุฑูุฑ ุงูุฃุนูุงู ุงูุชูุตููู
                    </h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-3xl font-bold text-blue-600">${totalJobs}</div>
                            <div class="text-blue-700">ุฅุฌูุงูู ุงูุฃุนูุงู</div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-3xl font-bold text-green-600">${totalHours.toFixed(1)}</div>
                            <div class="text-green-700">ุฅุฌูุงูู ุงูุณุงุนุงุช</div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                            <div class="text-3xl font-bold text-purple-600">${avgHoursPerJob.toFixed(1)}</div>
                            <div class="text-purple-700">ูุชูุณุท ุงูุณุงุนุงุช/ุนูู</div>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <div class="text-3xl font-bold text-yellow-600">${avgHourPrice.toFixed(0)}</div>
                            <div class="text-yellow-700">ูุชูุณุท ุณุนุฑ ุงูุณุงุนุฉ</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h5 class="font-bold text-lg text-gray-700 mb-4">ุชูุฒูุน ุญุงูุฉ ุงูุฏูุน</h5>
                            <div class="space-y-3">
                                ${Object.entries(paymentStats).map(([status, count]) => {
                                    const percentage = (count / totalJobs * 100).toFixed(1);
                                    const color = status === 'ููุฏู' ? 'green' : status === 'ูุตู' ? 'yellow' : 'red';
                                    return `
                                        <div class="flex items-center justify-between p-3 bg-${color}-50 rounded-lg">
                                            <div class="flex items-center">
                                                <span class="px-2 py-1 rounded-full text-xs bg-${color}-100 text-${color}-800 mr-3">
                                                    ${status}
                                                </span>
                                                <div class="font-medium">${count} ุนูููุฉ</div>
                                            </div>
                                            <div class="font-bold text-${color}-600">${percentage}%</div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h5 class="font-bold text-lg text-gray-700 mb-4">ุงูุฃุนูู ุฏุฎูุงู (ุขุฎุฑ 10 ุฃุนูุงู)</h5>
                            <div class="space-y-3 max-h-64 overflow-y-auto">
                                ${data.work
                                    .slice()
                                    .sort((a, b) => (b.hours * b.price) - (a.hours * a.price))
                                    .slice(0, 10)
                                    .map((work, index) => {
                                        const amount = work.hours * work.price;
                                        return `
                                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                                <div class="flex items-center">
                                                    <span class="text-lg font-bold text-gray-700 mr-3">${index + 1}</span>
                                                    <div>
                                                        <div class="font-medium">${work.name}</div>
                                                        <div class="text-sm text-gray-500">${work.date} - ${work.service}</div>
                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="font-bold text-green-600">${amount.toLocaleString()}</div>
                                                    <div class="text-sm text-gray-500">${work.hours} ุณุงุนุฉ</div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุฃูุซุฑ ุงูุฒุจุงุฆู ุฏูุนุงู
        function generateTopClientsReport() {
            const container = document.getElementById('reportContent');
            
            if (data.work.length === 0) {
                showNotification('ูุง ุชูุฌุฏ ุฃุนูุงู ูุณุฌูุฉ', 'info');
                return;
            }
            
            // ุชุฌููุน ุจูุงูุงุช ุงูุฒุจุงุฆู
            const clientStats = data.work.reduce((acc, w) => {
                const amount = w.hours * w.price;
                if (!acc[w.name]) {
                    acc[w.name] = {
                        count: 0,
                        amount: 0,
                        paid: 0,
                        debt: 0,
                        lastDate: w.date,
                        phone: w.phone
                    };
                }
                
                acc[w.name].count++;
                acc[w.name].amount += amount;
                acc[w.name].lastDate = w.date > acc[w.name].lastDate ? w.date : acc[w.name].lastDate;
                
                if (w.payStatus === 'ููุฏู') {
                    acc[w.name].paid += amount;
                } else if (w.payStatus === 'ูุตู') {
                    acc[w.name].paid += amount / 2;
                    acc[w.name].debt += amount / 2;
                } else {
                    acc[w.name].debt += amount;
                }
                
                return acc;
            }, {});
            
            // ุชุญููู ุฅูู ูุตูููุฉ ูุชุฑุชูุจ
            const clientArray = Object.entries(clientStats)
                .map(([name, stats]) => ({ name, ...stats }))
                .sort((a, b) => b.paid - a.paid); // ุชุฑุชูุจ ุญุณุจ ุงููุจูุบ ุงููุฏููุน
            
            let html = `
                <div class="bg-white p-6 rounded-xl shadow">
                    <h4 class="font-bold text-2xl text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-trophy text-yellow-600 mr-3"></i>ุฃูุซุฑ ุงูุฒุจุงุฆู ุฏูุนุงู
                    </h4>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full table-auto">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 text-right">ุงูุชุฑุชูุจ</th>
                                    <th class="px-4 py-3 text-right">ุงุณู ุงูุฒุจูู</th>
                                    <th class="px-4 py-3 text-right">ุนุฏุฏ ุงููุนุงููุงุช</th>
                                    <th class="px-4 py-3 text-right">ุฅุฌูุงูู ุงููุจูุบ</th>
                                    <th class="px-4 py-3 text-right">ุงููุจูุบ ุงููุฏููุน</th>
                                    <th class="px-4 py-3 text-right">ุงููุจูุบ ุงููุชุจูู</th>
                                    <th class="px-4 py-3 text-right">ูุณุจุฉ ุงูุฏูุน</th>
                                    <th class="px-4 py-3 text-right">ุขุฎุฑ ูุนุงููุฉ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${clientArray.map((client, index) => {
                                    const paymentRate = client.amount > 0 ? (client.paid / client.amount * 100).toFixed(1) : 0;
                                    const rateColor = paymentRate >= 100 ? 'text-green-600' : 
                                                     paymentRate >= 50 ? 'text-yellow-600' : 'text-red-600';
                                    
                                    return `
                                        <tr class="hover:bg-gray-50 ${index < 3 ? 'bg-yellow-50' : ''}">
                                            <td class="px-4 py-3 border-b">
                                                <div class="flex items-center justify-center">
                                                    ${index < 3 ? 
                                                        `<span class="px-2 py-1 rounded-full ${index === 0 ? 'bg-yellow-100 text-yellow-800' : 
                                                          index === 1 ? 'bg-gray-100 text-gray-800' : 'bg-orange-100 text-orange-800'}">
                                                            ${index + 1}
                                                        </span>` : 
                                                        `<span class="text-gray-600">${index + 1}</span>`
                                                    }
                                                </div>
                                            </td>
                                            <td class="px-4 py-3 border-b font-medium">
                                                ${client.name}
                                                ${client.phone ? `<br><span class="text-xs text-gray-500">${client.phone}</span>` : ''}
                                            </td>
                                            <td class="px-4 py-3 border-b text-center">${client.count}</td>
                                            <td class="px-4 py-3 border-b font-bold text-blue-600">${client.amount.toLocaleString()}</td>
                                            <td class="px-4 py-3 border-b font-bold text-green-600">${client.paid.toLocaleString()}</td>
                                            <td class="px-4 py-3 border-b font-bold ${client.debt > 0 ? 'text-red-600' : 'text-green-600'}">
                                                ${client.debt.toLocaleString()}
                                            </td>
                                            <td class="px-4 py-3 border-b font-bold ${rateColor}">${paymentRate}%</td>
                                            <td class="px-4 py-3 border-b">${client.lastDate}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="text-center p-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl">
                            <div class="text-2xl font-bold mb-2">${clientArray.filter(c => c.debt === 0).length}</div>
                            <div class="text-green-100">ุฒุจุงุฆู ุณุฏุฏูุง ูุงูู ุงููุจูุบ</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl">
                            <div class="text-2xl font-bold mb-2">
                                ${clientArray.reduce((sum, client) => sum + client.paid, 0).toLocaleString()}
                            </div>
                            <div class="text-blue-100">ุฅุฌูุงูู ุงููุจุงูุบ ุงููุฏููุนุฉ</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl">
                            <div class="text-2xl font-bold mb-2">
                                ${clientArray.reduce((sum, client) => sum + client.debt, 0).toLocaleString()}
                            </div>
                            <div class="text-red-100">ุฅุฌูุงูู ุงููุจุงูุบ ุงููุชุจููุฉ</div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ุฏุงูุฉ ุฅูุดุงุก ุชูุฑูุฑ ุงูุฎุฏูุงุช
        function generateServiceReport() {
            const container = document.getElementById('reportContent');
            
            if (data.work.length === 0) {
                showNotification('ูุง ุชูุฌุฏ ุฃุนูุงู ูุณุฌูุฉ', 'info');
                return;
            }
            
            // ุชุฌููุน ุฅุญุตุงุฆูุงุช ุงูุฎุฏูุงุช
            const serviceStats = data.work.reduce((acc, w) => {
                const amount = w.hours * w.price;
                if (!acc[w.service]) {
                    acc[w.service] = {
                        count: 0,
                        amount: 0,
                        totalHours: 0,
                        avgPrice: 0
                    };
                }
                
                acc[w.service].count++;
                acc[w.service].amount += amount;
                acc[w.service].totalHours += w.hours;
                return acc;
            }, {});
            
            // ุญุณุงุจ ุงููุชูุณุทุงุช
            Object.keys(serviceStats).forEach(service => {
                const stats = serviceStats[service];
                stats.avgPrice = stats.amount / stats.totalHours;
                stats.avgPerJob = stats.amount / stats.count;
            });
            
            // ุชุญููู ุฅูู ูุตูููุฉ ูุชุฑุชูุจ
            const serviceArray = Object.entries(serviceStats)
                .map(([name, stats]) => ({ name, ...stats }))
                .sort((a, b) => b.amount - a.amount);
            
            const totalAmount = serviceArray.reduce((sum, s) => sum + s.amount, 0);
            
            let html = `
                <div class="bg-white p-6 rounded-xl shadow">
                    <h4 class="font-bold text-2xl text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-cogs text-purple-600 mr-3"></i>ุชูุฑูุฑ ุงูุฎุฏูุงุช ุงูุฃูุซุฑ ุฑุจุญูุฉ
                    </h4>
                    
                    <div class="overflow-x-auto mb-8">
                        <table class="min-w-full table-auto">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 text-right">ุงูุฎุฏูุฉ</th>
                                    <th class="px-4 py-3 text-right">ุนุฏุฏ ุงูุฃุนูุงู</th>
                                    <th class="px-4 py-3 text-right">ุฅุฌูุงูู ุงูุณุงุนุงุช</th>
                                    <th class="px-4 py-3 text-right">ูุชูุณุท ุณุนุฑ ุงูุณุงุนุฉ</th>
                                    <th class="px-4 py-3 text-right">ูุชูุณุท ุฏุฎู/ุนูู</th>
                                    <th class="px-4 py-3 text-right">ุฅุฌูุงูู ุงูุฏุฎู</th>
                                    <th class="px-4 py-3 text-right">ุงููุณุจุฉ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${serviceArray.map((service, index) => {
                                    const percentage = (service.amount / totalAmount * 100).toFixed(1);
                                    return `
                                        <tr class="hover:bg-gray-50 ${index === 0 ? 'bg-green-50' : ''}">
                                            <td class="px-4 py-3 border-b font-medium">
                                                <div class="flex items-center">
                                                    ${index === 0 ? '<i class="fas fa-crown text-yellow-500 mr-2"></i>' : ''}
                                                    ${service.name}
                                                </div>
                                            </td>
                                            <td class="px-4 py-3 border-b text-center">${service.count}</td>
                                            <td class="px-4 py-3 border-b">${service.totalHours.toFixed(1)}</td>
                                            <td class="px-4 py-3 border-b font-bold text-blue-600">${service.avgPrice.toFixed(0)}</td>
                                            <td class="px-4 py-3 border-b font-bold text-green-600">${service.avgPerJob.toFixed(0)}</td>
                                            <td class="px-4 py-3 border-b font-bold text-purple-600">${service.amount.toLocaleString()}</td>
                                            <td class="px-4 py-3 border-b">
                                                <div class="flex items-center">
                                                    <div class="w-full bg-gray-200 rounded-full h-2.5 mr-3">
                                                        <div class="bg-green-600 h-2.5 rounded-full" style="width: ${percentage}%"></div>
                                                    </div>
                                                    <span class="font-bold">${percentage}%</span>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl">
                            <div class="text-2xl font-bold mb-2">${serviceArray.length}</div>
                            <div class="text-purple-100">ุนุฏุฏ ุฃููุงุน ุงูุฎุฏูุงุช</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl">
                            <div class="text-2xl font-bold mb-2">${serviceArray[0]?.name || 'ูุง ุชูุฌุฏ'}</div>
                            <div class="text-green-100">ุงูุฎุฏูุฉ ุงูุฃุนูู ุฑุจุญุงู</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl">
                            <div class="text-2xl font-bold mb-2">${serviceArray[0]?.amount?.toLocaleString() || 0}</div>
                            <div class="text-blue-100">ุฏุฎู ุงูุฎุฏูุฉ ุงูุฃููู</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-xl">
                            <div class="text-2xl font-bold mb-2">
                                ${serviceArray.length > 0 ? (serviceArray[0].amount / totalAmount * 100).toFixed(1) : 0}%
                            </div>
                            <div class="text-yellow-100">ุญุตุฉ ุงูุฎุฏูุฉ ุงูุฃููู</div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ========== ุงููุณุฎ ุงูุงุญุชูุงุทู ==========

        // ุฏุงูุฉ ุชุตุฏูุฑ ุงูุจูุงูุงุช
        function exportData() {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `tractor_backup_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showNotification('ุชู ุชุตุฏูุฑ ุงูุจูุงูุงุช ุจูุฌุงุญ', 'success');
        }

        // ุฏุงูุฉ ุชุตุฏูุฑ CSV
        function exportCSV() {
            if (data.work.length === 0) {
                showNotification('ูุง ุชูุฌุฏ ุจูุงูุงุช ููุชุตุฏูุฑ', 'error');
                return;
            }
            
            let csv = 'ุงุณู ุงูุฒุจูู,ุงูุชุงุฑูุฎ,ุงูุฎุฏูุฉ,ุงูููุงู,ุงูุณุงุนุงุช,ุณุนุฑ ุงูุณุงุนุฉ,ุงููุจูุบ,ุญุงูุฉ ุงูุฏูุน,ุงููุงุชู,ุงูููุงุญุธุงุช\n';
            
            data.work.forEach(work => {
                const amount = work.hours * work.price;
                const row = [
                    work.name,
                    work.date,
                    work.service,
                    work.location || '',
                    work.hours,
                    work.price,
                    amount,
                    work.payStatus,
                    work.phone || '',
                    work.notes || ''
                ].map(field => `"${field}"`).join(',');
                
                csv += row + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `tractor_data_${new Date().toISOString().slice(0, 10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('ุชู ุชุตุฏูุฑ ุงูุจูุงูุงุช ูููู Excel', 'success');
        }

        // ุฏุงูุฉ ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช
        function importData() {
            const fileInput = document.getElementById('importFile');
            if (!fileInput.files.length) {
                showNotification('ูุฑุฌู ุงุฎุชูุงุฑ ููู ุฃููุงู', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
                    if (!importedData.work || !importedData.expenses) {
                        throw new Error('ุชูุณูู ุงูููู ุบูุฑ ุตุญูุญ');
                    }
                    
                    if (confirm('ูู ุชุฑูุฏ ุงุณุชุจุฏุงู ุงูุจูุงูุงุช ุงูุญุงููุฉ ุจุงูุจูุงูุงุช ุงููุณุชูุฑุฏุฉุ')) {
                        localStorage.setItem('tractor_final_db', JSON.stringify(importedData));
                        location.reload();
                    }
                } catch (error) {
                    showNotification('ุฎุทุฃ ูู ูุฑุงุกุฉ ุงูููู. ุชุฃูุฏ ูู ุตุญุฉ ุชูุณูู JSON', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('ุฎุทุฃ ูู ูุฑุงุกุฉ ุงูููู', 'error');
            };
            
            reader.readAsText(file);
        }

        // ุฏุงูุฉ ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู
        function updateBackupStats() {
            const backups = Object.keys(localStorage).filter(key => key.startsWith('backup_'));
            const totalSize = backups.reduce((sum, key) => sum + localStorage.getItem(key).length, 0);
            
            document.getElementById('backupCount').innerText = backups.length;
            document.getElementById('storageSize').innerText = `${(totalSize / 1024).toFixed(2)} KB`;
            document.getElementById('autoBackups').innerText = localStorage.getItem('auto_backup_count') || 0;
            
            if (backups.length > 0) {
                const lastBackupKey = backups.sort().reverse()[0];
                const timestamp = parseInt(lastBackupKey.split('_')[1]);
                document.getElementById('lastBackup').innerText = new Date(timestamp).toLocaleDateString('ar-SA');
            }
        }

        // ุฏุงูุฉ ุงููุณุฎ ุงูุชููุงุฆู
        function autoBackup() {
            const backupKey = `backup_${Date.now()}`;
            localStorage.setItem(backupKey, JSON.stringify(data));
            
            // ุชุญุฏูุซ ุนุฏุงุฏ ุงููุณุฎ ุงูุชููุงุฆูุฉ
            const autoCount = parseInt(localStorage.getItem('auto_backup_count') || 0) + 1;
            localStorage.setItem('auto_backup_count', autoCount);
            
            // ุชูุธูู ุงููุณุฎ ุงููุฏููุฉ (ุชุญุชูุธ ููุท ุจู 10 ูุณุฎ)
            cleanupOldBackups();
            updateBackupStats();
        }

        // ุฏุงูุฉ ุชูุธูู ุงููุณุฎ ุงููุฏููุฉ
        function cleanupOldBackups() {
            const backups = Object.keys(localStorage)
                .filter(key => key.startsWith('backup_'))
                .map(key => ({
                    key,
                    timestamp: parseInt(key.split('_')[1])
                }))
                .sort((a, b) => b.timestamp - a.timestamp);
            
            // ุญุฐู ุงููุณุฎ ุงููุฏููุฉ ุฅุฐุง ุฒุงุฏุช ุนู 10
            if (backups.length > 10) {
                for (let i = 10; i < backups.length; i++) {
                    localStorage.removeItem(backups[i].key);
                }
            }
        }

        // ุฏุงูุฉ ุนุฑุถ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงููุญููุธุฉ
        function renderSavedBackups() {
            const container = document.getElementById('savedBackups');
            const backups = Object.keys(localStorage)
                .filter(key => key.startsWith('backup_'))
                .map(key => {
                    const timestamp = parseInt(key.split('_')[1]);
                    return {
                        key,
                        date: new Date(timestamp).toLocaleString('ar-SA'),
                        size: localStorage.getItem(key).length
                    };
                })
                .sort((a, b) => parseInt(b.key.split('_')[1]) - parseInt(a.key.split('_')[1]));
            
            if (backups.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-4 text-gray-500">
                        <i class="fas fa-database text-2xl mb-2"></i>
                        <p>ูุง ุชูุฌุฏ ูุณุฎ ุงุญุชูุงุทูุฉ ูุญููุธุฉ</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            backups.forEach(backup => {
                html += `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <i class="fas fa-database text-blue-500"></i>
                            <div>
                                <div class="font-medium">${backup.date}</div>
                                <div class="text-xs text-gray-500">${(backup.size / 1024).toFixed(2)} KB</div>
                            </div>
                        </div>
                        <div class="flex space-x-2 space-x-reverse">
                            <button onclick="restoreBackup('${backup.key}')" 
                                    class="text-green-600 hover:text-green-800 transition">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button onclick="deleteBackup('${backup.key}')" 
                                    class="text-red-600 hover:text-red-800 transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ุฏุงูุฉ ุงุณุชุนุงุฏุฉ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
        function restoreBackup(key) {
            if (confirm('ูู ุชุฑูุฏ ุงุณุชุนุงุฏุฉ ูุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉุ ุณูุชู ุงุณุชุจุฏุงู ุงูุจูุงูุงุช ุงูุญุงููุฉ.')) {
                try {
                    const backupData = JSON.parse(localStorage.getItem(key));
                    localStorage.setItem('tractor_final_db', JSON.stringify(backupData));
                    location.reload();
                } catch (error) {
                    showNotification('ุฎุทุฃ ูู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'error');
                }
            }
        }

        // ุฏุงูุฉ ุญุฐู ูุณุฎุฉ ุงุญุชูุงุทูุฉ
        function deleteBackup(key) {
            if (confirm('ูู ุชุฑูุฏ ุญุฐู ูุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉุ')) {
                localStorage.removeItem(key);
                renderSavedBackups();
                updateBackupStats();
                showNotification('ุชู ุญุฐู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ', 'success');
            }
        }

        // ุฅุถุงูุฉ event listeners
        function setupEventListeners() {
            // ุชุญุฏูุซ ุงุณู ุงูููู ุงููุฎุชุงุฑ
            document.getElementById('importFile').addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name || 'ูู ูุชู ุงุฎุชูุงุฑ ููู';
                document.getElementById('selectedFileName').innerText = `ุงูููู ุงููุฎุชุงุฑ: ${fileName}`;
            });
            
            // ุชูุนูู/ุชุนุทูู ุงููุณุฎ ุงูุชููุงุฆู
            document.getElementById('autoBackupToggle').addEventListener('click', toggleAutoBackup);
        }

        // ุฏุงูุฉ ุชูุนูู/ุชุนุทูู ุงููุณุฎ ุงูุชููุงุฆู
        function toggleAutoBackup() {
            autoBackupEnabled = !autoBackupEnabled;
            localStorage.setItem('auto_backup_enabled', autoBackupEnabled);
            
            if (autoBackupEnabled) {
                document.getElementById('autoBackupToggle').innerHTML = '<i class="fas fa-robot mr-1"></i>ุฅููุงู ุงููุณุฎ ุงูุชููุงุฆู';
                showNotification('ุชู ุชูุนูู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชููุงุฆู', 'success');
                autoBackup();
            } else {
                document.getElementById('autoBackupToggle').innerHTML = '<i class="fas fa-robot mr-1"></i>ุชูุนูู ุงููุณุฎ ุงูุชููุงุฆู';
                showNotification('ุชู ุฅููุงู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชููุงุฆู', 'info');
            }
        }

        // ุชููุฆุฉ ุงูุชุจููุจุงุช
        function initTabs() {
            switchTab('work');
        }

        // ุฏุงูุฉ ุนุฑุถ ุฅุดุนุงุฑุงุช
        function showNotification(message, type = 'info') {
            const icon = type === 'success' ? 'check-circle' :
                        type === 'error' ? 'exclamation-circle' :
                        type === 'warning' ? 'exclamation-triangle' : 'info-circle';
            
            const color = type === 'success' ? 'bg-green-600' :
                         type === 'error' ? 'bg-red-600' :
                         type === 'warning' ? 'bg-yellow-600' : 'bg-blue-600';
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-xl text-white z-50 transform transition-all duration-300 slide-up ${color}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${icon} mr-3 text-xl"></i>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
    
    <!-- Service Worker Registration -->
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/sw.js').then(
                function(registration) {
                    console.log('Service Worker registered successfully');
                },
                function(err) {
                    console.log('Service Worker registration failed: ', err);
                }
            );
        });
    }
    </script>
</body>
  </html>
