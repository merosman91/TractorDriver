<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø±Ø§Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <meta name="theme-color" content="#1b5e20">
    <style>
        :root { 
            --primary: #2E7D32; --accent: #f57c00; --bg: #f8f9fa; 
            --text: #212529; --danger: #c62828; --warning: #fbc02d; --info: #0277bd;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg); margin: 0; padding-bottom: 80px; color: var(--text); }
        header { background: var(--primary); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        .container { max-width: 800px; margin: auto; padding: 15px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #eee; }
        
        /* ØªÙ‚Ø§Ø±ÙŠØ± Ø³Ø±ÙŠØ¹Ø© */
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 15px; border-radius: 12px; text-align: center; border-bottom: 4px solid var(--primary); }
        .stat-card small { font-size: 0.7rem; color: #666; display: block; }
        .stat-card span { font-weight: bold; font-size: 1.1rem; color: var(--primary); }

        /* Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .full-width { grid-column: span 2; }
        label { display: block; font-size: 0.8rem; margin-bottom: 4px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        
        /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
        .tabs { display: flex; background: #eee; border-radius: 10px; margin-bottom: 20px; padding: 5px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 8px; font-size: 0.9rem; }
        .tab.active { background: var(--primary); color: white; }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ */
        .entry-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; position: relative; border-right: 8px solid #ccc; }
        .pay-Ù…Ù‚Ø¯Ù… { border-right-color: #4caf50; }
        .pay-Ø£Ø¬Ù„ { border-right-color: var(--danger); }
        .pay-Ø¬Ø²Ø¦ÙŠ { border-right-color: var(--warning); }
        
        .entry-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .location-tag { font-size: 0.8rem; color: #666; background: #f0f0f0; padding: 2px 8px; border-radius: 4px; margin-top: 5px; display: inline-block; }
        
        .btn { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-add { background: var(--primary); color: white; }
        .btn-wa { background: #25D366; color: white; margin-top: 5px; }
        
        .report-section { display: none; }
        .report-section.active { display: block; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        th, td { border: 1px solid #eee; padding: 8px; text-align: center; }
        th { background: #f4f4f4; }

        .action-icons { display: flex; gap: 10px; margin-top: 10px; justify-content: flex-end; }
        .icon-btn { border: 1px solid #ddd; padding: 8px; border-radius: 5px; background: white; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <h1>ğŸšœ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</h1>
</header>

<div class="container">
    <div class="dashboard">
        <div class="stat-card">
            <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚</small>
            <span id="statTotal">0</span>
        </div>
        <div class="stat-card">
            <small>Ø¯ÙŠÙˆÙ† (Ø£Ø¬Ù„)</small>
            <span id="statDebt" style="color:var(--danger)">0</span>
        </div>
        <div class="stat-card">
            <small>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</small>
            <span id="statHours">0</span>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('entry')">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„</div>
        <div class="tab" onclick="switchTab('list')">ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
        <div class="tab" onclick="switchTab('reports')">ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ±</div>
    </div>

    <div id="entrySection" class="report-section active">
        <div class="card">
            <div class="form-grid">
                <div class="form-group full-width">
                    <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
                    <input type="text" id="clientName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø­Ø§Ø¬ Ø£Ø­Ù…Ø¯" list="clientsList">
                    <datalist id="clientsList"></datalist>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="workDate">
                </div>
                <div class="form-group">
                    <label>Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„ (Ø§Ù„Ù…ÙˆÙ‚Ø¹)</label>
                    <input type="text" id="workLocation" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø²Ø±Ø¹Ø©/Ø§Ù„Ù‚Ø±ÙŠØ©">
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                    <select id="serviceType">
                        <option value="Ø­Ø±Ø§Ø«Ø©">Ø­Ø±Ø§Ø«Ø©</option>
                        <option value="Ù‚ØµØ§Ø¨ÙŠØ©">Ù‚ØµØ§Ø¨ÙŠØ©</option>
                        <option value="ØªÙ†Ø¹ÙŠÙ…">ØªÙ†Ø¹ÙŠÙ…</option>
                        <option value="Ù†Ù‚Ù„">Ù†Ù‚Ù„</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select id="payStatus">
                        <option value="Ø£Ø¬Ù„">Ø£Ø¬Ù„ (Ø¯ÙŠÙ†)</option>
                        <option value="Ù…Ù‚Ø¯Ù…">Ù…Ù‚Ø¯Ù… (Ø®Ø§Ù„Øµ)</option>
                        <option value="Ø¬Ø²Ø¦ÙŠ">Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</label>
                    <input type="number" id="workHours" step="0.5" oninput="calcTotal()">
                </div>
                <div class="form-group">
                    <label>Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø©</label>
                    <input type="number" id="hourPrice" oninput="calcTotal()">
                </div>
                <div class="form-group full-width">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="clientPhone" placeholder="05xxxxxxxx">
                </div>
            </div>
            <div id="calcPreview" style="text-align: center; margin-top:15px; font-weight:bold; color:var(--primary)">
                Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0
            </div>
            <button class="btn btn-add" onclick="saveEntry()" id="saveBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„</button>
        </div>
    </div>

    <div id="listSection" class="report-section">
        <input type="text" id="searchBox" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…ÙƒØ§Ù†..." oninput="renderList()" style="margin-bottom:15px">
        <div id="mainList"></div>
    </div>

    <div id="reportsSection" class="report-section">
        <div class="card">
            <h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h3>
            <table id="serviceReportTable">
                <thead><tr><th>Ø§Ù„Ø®Ø¯Ù…Ø©</th><th>Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card">
            <h3>ğŸ’° ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯ÙØ¹Ø§Øª</h3>
            <div id="payTypeChart"></div>
            <table id="payReportTable">
                <thead><tr><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let entries = JSON.parse(localStorage.getItem('tractor_pro_data')) || [];
    let editId = null;

    document.getElementById('workDate').valueAsDate = new Date();

    function switchTab(tab) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.report-section').forEach(s => s.classList.remove('active'));
        
        event.currentTarget.classList.add('active');
        document.getElementById(tab + 'Section').classList.add('active');
        
        if(tab === 'reports') generateReports();
        if(tab === 'list') renderList();
    }

    function calcTotal() {
        const h = document.getElementById('workHours').value || 0;
        const p = document.getElementById('hourPrice').value || 0;
        document.getElementById('calcPreview').innerText = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${h * p}`;
    }

    function saveEntry() {
        const entry = {
            id: editId || Date.now(),
            name: document.getElementById('clientName').value,
            date: document.getElementById('workDate').value,
            location: document.getElementById('workLocation').value,
            service: document.getElementById('serviceType').value,
            payStatus: document.getElementById('payStatus').value,
            hours: parseFloat(document.getElementById('workHours').value),
            price: parseFloat(document.getElementById('hourPrice').value),
            phone: document.getElementById('clientPhone').value
        };

        if(!entry.name || !entry.hours) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©");

        if(editId) {
            entries = entries.map(e => e.id === editId ? entry : e);
            editId = null;
            document.getElementById('saveBtn').innerText = "ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„";
        } else {
            entries.unshift(entry);
        }

        localStorage.setItem('tractor_pro_data', JSON.stringify(entries));
        resetForm();
        updateStats();
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­");
        switchTab('list');
    }

    function resetForm() {
        document.getElementById('clientName').value = '';
        document.getElementById('workHours').value = '';
        document.getElementById('workLocation').value = '';
        document.getElementById('clientPhone').value = '';
        calcTotal();
    }

    function updateStats() {
        const total = entries.reduce((s, e) => s + (e.hours * e.price), 0);
        const debt = entries.reduce((s, e) => e.payStatus === 'Ø£Ø¬Ù„' ? s + (e.hours * e.price) : s, 0);
        const hours = entries.reduce((s, e) => s + e.hours, 0);

        document.getElementById('statTotal').innerText = total.toLocaleString();
        document.getElementById('statDebt').innerText = debt.toLocaleString();
        document.getElementById('statHours').innerText = hours;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„Ø£Ø³Ù…Ø§Ø¡
        const names = [...new Set(entries.map(e => e.name))];
        document.getElementById('clientsList').innerHTML = names.map(n => `<option value="${n}">`).join('');
    }

    function renderList() {
        const query = document.getElementById('searchBox').value.toLowerCase();
        const listDiv = document.getElementById('mainList');
        listDiv.innerHTML = '';

        entries.filter(e => e.name.toLowerCase().includes(query) || e.location.toLowerCase().includes(query))
        .forEach(e => {
            const total = e.hours * e.price;
            const div = document.createElement('div');
            div.className = `entry-card pay-${e.payStatus}`;
            div.innerHTML = `
                <div class="entry-header">
                    <div>
                        <strong>${e.name}</strong> <small>(${e.date})</small>
                        <div class="location-tag">ğŸ“ ${e.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                    </div>
                    <div style="text-align:left">
                        <span style="display:block; font-weight:bold">${total}</span>
                        <small>${e.payStatus}</small>
                    </div>
                </div>
                <div style="margin-top:10px; font-size:0.9rem">
                    ğŸšœ ${e.service} | â±ï¸ ${e.hours} Ø³Ø§Ø¹Ø© | ğŸ’° ${e.price}/Ø³Ø§Ø¹Ø©
                </div>
                <div class="action-icons">
                    <button class="icon-btn" onclick="shareWA(${e.id})">ğŸ’¬</button>
                    <button class="icon-btn" onclick="window.open('tel:${e.phone}')">ğŸ“</button>
                    <button class="icon-btn" onclick="editEntry(${e.id})">âœï¸</button>
                    <button class="icon-btn" onclick="deleteEntry(${e.id})" style="color:red">ğŸ—‘ï¸</button>
                </div>
            `;
            listDiv.appendChild(div);
        });
    }

    function generateReports() {
        // ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª
        const serviceMap = {};
        const payMap = { 'Ù…Ù‚Ø¯Ù…': 0, 'Ø£Ø¬Ù„': 0, 'Ø¬Ø²Ø¦ÙŠ': 0 };

        entries.forEach(e => {
            const amt = e.hours * e.price;
            serviceMap[e.service] = serviceMap[e.service] || { h: 0, m: 0 };
            serviceMap[e.service].h += e.hours;
            serviceMap[e.service].m += amt;
            
            payMap[e.payStatus] += amt;
        });

        const sBody = document.querySelector('#serviceReportTable tbody');
        sBody.innerHTML = Object.keys(serviceMap).map(s => `
            <tr><td>${s}</td><td>${serviceMap[s].h}</td><td>${serviceMap[s].m}</td></tr>
        `).join('');

        const pBody = document.querySelector('#payReportTable tbody');
        pBody.innerHTML = Object.keys(payMap).map(p => `
            <tr><td>${p}</td><td>${payMap[p]}</td></tr>
        `).join('');
    }

    function shareWA(id) {
        const e = entries.find(i => i.id === id);
        const text = `*ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ Ø¬Ø±Ø§Ø±*%0AØ§Ù„Ø²Ø¨ÙˆÙ†: ${e.name}%0AØ§Ù„Ù…ÙˆÙ‚Ø¹: ${e.location}%0AØ§Ù„Ø®Ø¯Ù…Ø©: ${e.service}%0AØ§Ù„Ø³Ø§Ø¹Ø§Øª: ${e.hours}%0AØ§Ù„Ù…Ø¨Ù„Øº: ${e.hours * e.price}%0AØ§Ù„Ø­Ø§Ù„Ø©: ${e.payStatus}`;
        window.open(`https://wa.me/${e.phone}?text=${text}`);
    }

    function editEntry(id) {
        const e = entries.find(i => i.id === id);
        editId = id;
        document.getElementById('clientName').value = e.name;
        document.getElementById('workDate').value = e.date;
        document.getElementById('workLocation').value = e.location;
        document.getElementById('serviceType').value = e.service;
        document.getElementById('payStatus').value = e.payStatus;
        document.getElementById('workHours').value = e.hours;
        document.getElementById('hourPrice').value = e.price;
        document.getElementById('clientPhone').value = e.phone;
        document.getElementById('saveBtn').innerText = "ğŸ†™ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„";
        switchTab('entry');
        calcTotal();
    }

    function deleteEntry(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
            entries = entries.filter(e => e.id !== id);
            localStorage.setItem('tractor_pro_data', JSON.stringify(entries));
            renderList();
            updateStats();
        }
    }

    updateStats();
</script>
</body>
</html>
